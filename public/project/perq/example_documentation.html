<script src="example_documentation_files/htmlwidgets/htmlwidgets.js"></script>
<script src="example_documentation_files/jquery/jquery.min.js"></script>
<link href="example_documentation_files/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="example_documentation_files/datatables-binding/datatables.js"></script>
<link href="example_documentation_files/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="example_documentation_files/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="example_documentation_files/dt-core/js/jquery.dataTables.min.js"></script>
<link href="example_documentation_files/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="example_documentation_files/crosstalk/js/crosstalk.min.js"></script>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The Perq program, is a rebranding of the MBTA’s Corporate Pass Program. Through Perq, employers can offer pretax or subsidized monthly passes to their employees. Perq is a way for employers to incentivize their employees to replace vehicle trips with transit for their daily commute.</p>
<p>As part of the Emissions Scaling Project, we measure the pounds of <span class="math inline">\(CO_2\)</span> saved by employees by using public transit in place of single-occupancy personal vehicles. We measure these numbers by utilising the Origin-Destination data gathered through the Perq CharlieCards for a given month. For this example, we will be using data from September 2018.</p>
<p>Travel modes were inferred through the dataset for bus and subway. For Commuter Rail, as there is no automated fare collection, we do not have Origin-Destination data. We therefore estimate by averaging the distances from stations in each Commuter Rail Zone to their respective Downtown Station (North or South Station).</p>
<p>For a detailed description and the blog entry please see the <a href="https://www.mbtabackontrack.com/blog/104-perq-pass-carbon-emissions-savings">mbtabackontrack</a> blog.</p>
<p>We calculate distances and time taken for a given Origin-Destination pair. This helps us calculate the pounds of <span class="math inline">\(CO_2\)</span> emitted by each journey. These values are then aggregated by company and the mode of travel. Thus, the final output is anonymised, and all personally identifiable information is stripped.</p>
<p><strong>Please Note: Names of certain tables, schemas and companies have been changed for proprietary and privacy reasons. Any aggregations showns in this documentation are kept to 10 units or more for privacy protection.</strong></p>
</div>
<div id="the-scripting" class="section level1">
<h1>The Scripting</h1>
<p>In order to get the base Charliecard data, we have to connect to the Postgres server where it is stored. This involves SQL scripting, which can be achieved by utilising functions from two R-packages. In addition, the script makes use of predefined variables, which can be changed according to the user, month of query, and the list of companies for which data is required.</p>
<div id="packages" class="section level2">
<h2>Packages:</h2>
<p>We require the following packages to be installed/loaded for the script to run:</p>
<pre class="r"><code>library(DBI) #for the SQL queries
library(RPostgres) #for thhe Postgres Server connection
library(DescTools) #for statistical/data wrangling tools
library(tidyverse) #for statistical/data wrangling tools</code></pre>
<pre><code>## -- Attaching packages --------------------------------------------------------------- tidyverse 1.2.1 --</code></pre>
<pre><code>## v ggplot2 3.3.0     v purrr   0.3.4
## v tibble  2.1.3     v dplyr   0.8.5
## v tidyr   1.0.2     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.4.0</code></pre>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 3.6.3</code></pre>
<pre><code>## Warning: package &#39;tidyr&#39; was built under R version 3.6.3</code></pre>
<pre><code>## Warning: package &#39;purrr&#39; was built under R version 3.6.3</code></pre>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 3.6.3</code></pre>
<pre><code>## -- Conflicts ------------------------------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(gmapsdistance) #for getting the distances/times through the use of Google&#39;s distance API
library(lubridate) #for working with time-related data</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<pre class="r"><code>library(DT) #for making interactive charts in an html</code></pre>
<pre><code>## Warning: package &#39;DT&#39; was built under R version 3.6.3</code></pre>
</div>
<div id="defining-ad-hoc-functions" class="section level2">
<h2>Defining Ad-hoc Functions:</h2>
<p>We created two ad-hoc functions which are used in our script. These are not part of any packages, and thus have to be separately defined.</p>
<p><strong>Shift Function:</strong>
It is used to shift particular rows ‘up’ by ‘n’ count. A negative value will push them down. We use this function while getting a list of distinct journeys from the ‘legs’ table (which is explained in detail below). Essentially, for every journey, we need information on the first leg’s origin, and the last leg’s destination. We use the <em>shift</em> function for ‘shifting’ the cells in the last leg’s destination columns.</p>
<pre class="r"><code>shift &lt;- function(x, n){
  c(x[-(seq(n))], rep(NA, n))
}</code></pre>
<p><strong>Next Weekday Function:</strong>
The GmapsDistance function works only with future date-times. As such, we need to specify an arrival/departure date in the future. This function takes a particular input date, and day-of-the-week code, and gives the next date of that particular day.</p>
<table>
<thead>
<tr class="header">
<th align="right">Code (wday)</th>
<th align="left">Day</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Sunday</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Monday</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">Tuesday</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">Wednesday</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">Thursday</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">Friday</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">Saturday</td>
</tr>
</tbody>
</table>
<pre class="r"><code>nextweekday &lt;- function(date, wday) { #date = date you want to get next weekday for, wday = day of the week you want the date for.
  date &lt;- as.Date(date)
  diff &lt;- wday - wday(date)
  if( diff &lt;= 0)
    diff &lt;- diff + 7
  return(date + diff)
}</code></pre>
</div>
<div id="relevant-variables" class="section level2">
<h2>Relevant Variables:</h2>
<p><strong>API Key:</strong> We need the API key as provided by Google for its Distance calculation function. You can get one by checking <a href="https://cloud.google.com/maps-platform/?apis=routes">Google’s Cloud Computing Services</a>.</p>
<pre class="r"><code>set.api.key = (&quot;API_KEY_FROM_GOOGLE&quot;)</code></pre>
<p><strong>Enquiry Year and month:</strong> The year for which the Perq data is being queried for: In this example we are querying data for September 2018.</p>
<pre class="r"><code>yyyy&lt;- paste0(&quot;2018&quot;)
mm &lt;- paste0(&quot;09&quot;)</code></pre>
<p><strong>Company List:</strong> The IDs of the companies for which data is being queried:</p>
<pre class="r"><code>companylist &lt;- paste0(&quot;1110,3574,11078,2456,1136,1783,1762,1801,1858,1840,1968,3480,1025,3171,1904,1709,3199&quot;)</code></pre>
<p><strong>Number of Working Days:</strong> The number of working days for the month of query:</p>
<pre class="r"><code>w_days &lt;- 19</code></pre>
<p><strong>Date and Time of function call:</strong> We use the date for the upcoming Thursday, which is considered a typical workday, and an arrival time of 9:00am. For the month of September in 2018, around 68% of all trips happened during peak hours, and as such, we can apply the same time-stamp for off-peak trips.</p>
<pre class="r"><code>funct_calldate &lt;- nextweekday(Sys.Date(), 5)
funct_calltime &lt;- &quot;09:00:00&quot;</code></pre>
<p><strong>Variables required for the SQL server Connection:</strong></p>
<ol style="list-style-type: decimal">
<li>SSL Certificates:
These are your personal SSL certificate and key used while connecting to the Postgres Server. You will specify the path to the files stored on your personal work computer.</li>
</ol>
<pre class="r"><code>cl_cert &lt;- paste0(&quot;PATH_TO_YOUR_POSTGRES_CREDENTIALS_/adeodhar.crt&quot;)
cl_key &lt;- paste0(&quot;PATH_TO_YOUR_POSTGRES_CREDENTIALS_/adeodhar.key&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Connection to the Postgres server:</li>
</ol>
<p><strong>dbConnect:</strong></p>
<p>This function is used to define a connection to the Postgres server. It takes the following arguments:</p>
<ol style="list-style-type: lower-alpha">
<li><p><strong>drv:</strong> Driver used to define which kind of SQL server to connect to. In the case of the MBTA’s research server, we use ‘Postgres()’</p></li>
<li><p><strong>user:</strong> It is your username, which is used on the Postgres server. For example, John Smith’s username is ‘jsmith’. However, we use a ‘askForPassword’ function. A window will popup, wherein you will enter your username.</p></li>
<li><p><strong>dbname:</strong> It is the database name</p></li>
<li><p><strong>host:</strong> The url of the host server</p></li>
<li><p><strong>port:</strong> 5432</p></li>
<li><p><strong>sslcert:</strong> The individual user’s personal SSL Certificate used for connecting to the Research Server. It will be in the format: ‘jsmith.crt’. The path is absolute, and will change according where it is stored on the user’s system.</p></li>
<li><p><strong>sslkey:</strong> The individual user’s personal SSL Key used for connecting to the Research Server. It will be in the format: ‘jsmith.key’. The path is absolute, and will change according where it is stored on the user’s system.</p></li>
</ol>
<pre class="r"><code>con &lt;- dbConnect(
Postgres(), 
user = askForPassword(&quot;Database User Name&quot;),
dbname = &#39;dbname&#39;,
host = &#39;host.server.org&#39;,
port = 5432,
sslcert = cl_cert,
sslkey = cl_key
)</code></pre>
<p>We thus define a variable <strong>con</strong> as the connection to the research server. We will use it in the following function when running SQL queries.</p>
<p>We have now thus defined our variables which will be used throughout the script. We do not need to define any other variables, and just run the script for the desired output.</p>
</div>
<div id="sql-queries" class="section level2">
<h2>SQL Queries:</h2>
<p>We use our last three variables, that is the SSL Certificate, SSL Key, and the Postgres server connection to run our SQL queries from within R:</p>
<div id="access-to-schematables" class="section level3">
<h3>Access to Schema/Tables:</h3>
<p>There are a few schemas and tables we need access to which are on the Research Server:</p>
<table>
<thead>
<tr class="header">
<th align="right">Schema</th>
<th align="left">Table</th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><strong>perq</strong></td>
<td align="left">emissions_bymode</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="right"></td>
<td align="left">companynamelist</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="right"></td>
<td align="left">cr_reference</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="right"><strong>card_info</strong></td>
<td align="left">cardorders</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="right"></td>
<td align="left">companyorders</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="right"><strong>odx</strong></td>
<td align="left">odx_yyyymm</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="right"></td>
<td align="left">rides_yyyymm</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="right"><strong>gtfs</strong></td>
<td align="left">stops</td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div id="emissions-by-mode" class="section level3">
<h3>Emissions By Mode:</h3>
<p>This query gets the table in which emissions (in pounds of <span class="math inline">\(CO_2\)</span>) per passenger mile by vehicle mode are stored.</p>
<pre class="r"><code>emissions_bymode &lt;- dbGetQuery(con, &quot;SELECT * 
           FROM perq.emissions_bymode&quot;)</code></pre>
<div id="htmlwidget-012970e5f3b1f9e112ee" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-012970e5f3b1f9e112ee">{"x":{"filter":"none","data":[["1"],[0.8708],[0.2337],[0.2359],[0.3836],[0],[0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>co2_car<\/th>\n      <th>co2_subway<\/th>\n      <th>co2_bus<\/th>\n      <th>co2_commrail<\/th>\n      <th>co2_walk<\/th>\n      <th>co2_bike<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"callback":"function(table) {\nreturn table;\n}"},"evals":["callback"],"jsHooks":[]}</script>
</div>
<div id="corporate-names-list" class="section level3">
<h3>Corporate Names List:</h3>
<p>This query gets the names of companies with their company IDs. Most proceeding queries have data only by the company ID, and we join this table to get the name of the company for easy identification.</p>
<pre class="r"><code>corporate_list &lt;- dbGetQuery(con, paste0(&quot;SELECT idcompany, companyname 
FROM perq.companynamelist
WHERE idcompany IN (&quot;,companylist,&quot;)
GROUP BY idcompany, companyname
ORDER BY companyname&quot;))
corporate_list$idcompany &lt;- as.numeric(corporate_list$idcompany)</code></pre>
<div id="htmlwidget-021d52df0d1779d035a2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-021d52df0d1779d035a2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17"],[1904,1709,3199,3171,1025,1110,3480,1968,1840,1858,1801,1762,1783,1136,2456,11078,3574],["Company A","Company B","Company C","Company D","Company E","Company F","Company G","Company H","Company I","Company J","Company K","Company L","Company M","Company N","Company O","Company P","Company Q"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>idcompany<\/th>\n      <th>companyname<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"callback":"function(table) {\nreturn table;\n}"},"evals":["callback"],"jsHooks":[]}</script>
</div>
<div id="commuter-rail-pass-data" class="section level3">
<h3>Commuter Rail Pass Data:</h3>
<p>Commuter rail pass data is worked separately due to the nature of the data we have. The only definitive data we have on users of Commuter Rail is the number of passes issued by Zone to each company per month. As such, calculation for Commuter Rail are done separately from that of Subway and Bus.</p>
<p><strong>Passes Issued by Company</strong></p>
<pre class="r"><code>cr_bycompany &lt;- dbGetQuery(con, paste0(&quot;SELECT 
b.IdCompany
,cr.productname AS zone
,cr.count AS count
FROM (SELECT idcompany FROM card_info.cardorders
        WHERE ordermonth =&quot;,yyyy,mm, &quot; AND
        (idcompany IN (&quot;,companylist,&quot;))
        GROUP BY idcompany) b
LEFT JOIN card_info.companyorders cr
    ON cr.idcompany = b.idcompany
    WHERE month_0 = &#39;&quot;,yyyy,&quot;-&quot;,mm,&quot;-01&#39; AND
category_0 = &#39;Commuter Rail&#39;&quot;))
cr_bycompany &lt;- merge(cr_bycompany, corporate_list, by = &quot;idcompany&quot;)
cr_bycompany$zone &lt;- gsub(&quot;Commuter Rail Zone &quot;, &quot;&quot;, cr_bycompany$zone)
cr_bycompany$zone &lt;- gsub(&quot;A Pass&quot;, &quot;A&quot;, cr_bycompany$zone)</code></pre>
<p>The following table shows the count of Commuter Rail passes issued to the City of Cambridge by Zone:
<div id="htmlwidget-dcd899a9c91323514098" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-dcd899a9c91323514098">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145"],[1025,1025,1025,1025,1025,1025,1025,1025,1110,1110,1110,1110,1110,1110,1110,1110,1110,1136,1136,1136,1136,1136,1136,1136,1136,1136,1709,1709,1709,1709,1709,1709,1709,1709,1709,1709,1762,1762,1762,1762,1762,1762,1762,1762,1762,1783,1783,1783,1783,1783,1783,1783,1783,1783,1801,1801,1801,1801,1801,1801,1801,1801,1801,1801,1840,1840,1840,1840,1840,1840,1840,1840,1840,1858,1858,1858,1858,1858,1858,1858,1858,1858,1858,1904,1904,1904,1904,1904,1904,1904,1904,1904,1968,1968,1968,1968,2456,2456,2456,2456,2456,2456,2456,2456,2456,3171,3171,3171,3171,3171,3171,3171,3171,3171,3199,3199,3199,3199,3199,3199,3199,3199,3199,3199,3199,3480,3480,3480,3480,3480,3480,3480,3480,3480,3574,11078,11078,11078,11078,11078,11078,11078,11078,11078,11078],["6","8","5","1A","3","4","1","2","1","2","3","4","1A","6","7","8","5","3","4","6","7","8","5","1A","2","1","1","10","2","7","8","9","5","6","3","4","2","3","1","1A","5","6","8","4","7","2","3","1","1A","5","6","4","8","7","8","7","3","6","1","1A","4","5","2","9","8","1A","1","3","4","6","7","5","2","1","1A","3","4","5","2","7","8","9","6","1A","2","1","5","6","3","4","8","7","5","1A","3","8","1","1A","2","3","4","5","6","7","8","1","1A","2","3","4","5","6","7","8","1","10","1A","2","3","4","5","6","7","8","9","1","1A","2","3","4","5","6","7","8","1A","1","1A","2","3","4","5","6","7","8","9"],[5,3,4,9,9,6,5,1,4,4,10,10,29,3,2,4,4,14,14,15,8,2,10,9,29,11,13,2,12,11,8,1,13,28,12,15,20,13,14,17,4,18,5,16,2,9,25,13,2,11,31,17,13,17,13,14,18,19,6,10,6,5,9,1,2,4,3,5,6,6,3,6,9,8,4,23,16,7,31,8,5,1,30,3,14,7,7,13,8,11,2,3,1,3,1,1,11,8,14,10,18,2,7,11,3,7,5,12,19,9,6,14,7,5,6,1,1,8,7,12,8,15,12,12,1,5,10,11,10,7,4,6,6,2,3,2,2,13,10,7,9,23,10,14,1],["Company E","Company E","Company E","Company E","Company E","Company E","Company E","Company E","Company F","Company F","Company F","Company F","Company F","Company F","Company F","Company F","Company F","Company N","Company N","Company N","Company N","Company N","Company N","Company N","Company N","Company N","Company B","Company B","Company B","Company B","Company B","Company B","Company B","Company B","Company B","Company B","Company L","Company L","Company L","Company L","Company L","Company L","Company L","Company L","Company L","Company M","Company M","Company M","Company M","Company M","Company M","Company M","Company M","Company M","Company K","Company K","Company K","Company K","Company K","Company K","Company K","Company K","Company K","Company K","Company I","Company I","Company I","Company I","Company I","Company I","Company I","Company I","Company I","Company J","Company J","Company J","Company J","Company J","Company J","Company J","Company J","Company J","Company J","Company A","Company A","Company A","Company A","Company A","Company A","Company A","Company A","Company A","Company H","Company H","Company H","Company H","Company O","Company O","Company O","Company O","Company O","Company O","Company O","Company O","Company O","Company D","Company D","Company D","Company D","Company D","Company D","Company D","Company D","Company D","Company C","Company C","Company C","Company C","Company C","Company C","Company C","Company C","Company C","Company C","Company C","Company G","Company G","Company G","Company G","Company G","Company G","Company G","Company G","Company G","Company Q","Company P","Company P","Company P","Company P","Company P","Company P","Company P","Company P","Company P","Company P"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>idcompany<\/th>\n      <th>zone<\/th>\n      <th>count<\/th>\n      <th>companyname<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"callback":"function(table) {\nreturn table;\n}"},"evals":["callback"],"jsHooks":[]}</script></p>
<p><strong>Commuter Rail Distance (in miles) and Time Taken (in minutes)</strong></p>
<p>This data is by zone. The distances and times are the averages of all the stations within that zone to their corresponding station in Downtown (North or South Station, depending on what line they are)</p>
<pre class="r"><code>cr_reference &lt;- dbGetQuery(con, &quot;SELECT * 
           FROM perq.cr_reference&quot;)</code></pre>
<div id="htmlwidget-b20120c44311cb13f3a0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b20120c44311cb13f3a0">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11"],["1A","1","2","3","4","5","6","7","8","9","10"],[29.06018519,31.96190476,33.575,35.36666667,44.85208333,49.96410256,57.88717949,65.45166667,78.65897436,107.5333333,114.3833333],[4.144444444,7.35,11.22727273,14.57777778,18.70625,22,26.50769231,31.86,40.53076923,51.9,62.9],[16.06944444,22.26071429,22.6969697,27.44444444,34.328125,37.68717949,41.19230769,45.60166667,52.48461538,66.73333333,77.1],[6.708047226,11.6177328,15.51524325,18.84929512,23.32775031,26.74037467,32.79133514,37.32328203,44.10688693,59.09488587,69.47427026]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>zone<\/th>\n      <th>cr_min_tr<\/th>\n      <th>cr_miles_tr<\/th>\n      <th>cr_min_dr<\/th>\n      <th>cr_miles_dr<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"callback":"function(table) {\nreturn table;\n}"},"evals":["callback"],"jsHooks":[]}</script>
</div>
<div id="odx-perq-charliecard-data" class="section level3">
<h3>ODX Perq CharlieCard Data:</h3>
<p>The major part of this script is based on the origins and destinations inferred from taps by the ODX Inference Model. Due to the nature of the inference model which infers destinations based on previous journeys, not all taps register a destinations, for example, for atypical one-off journeys. However, all taps are indicative of undertaken journeys. We therefore get a table of all recorded taps, whether they have inferred destinations or not. We use this count to scale up from the list of taps for which there are inferred destinations. This takes into assumption that the distance and time taken for these trips is normally distributed over the network.</p>
<p>All card level data is completely anonymized, and no individual can be identified with any of the card level information available at this aggregation level.</p>
<p><strong>All Registered Taps</strong></p>
<pre class="r"><code>taps &lt;- dbGetQuery(con, paste0(&quot;SELECT * FROM(
    SELECT b.SerialNumber
        ,b.IdCompany
        ,o.*
        FROM (SELECT * FROM card_info.cardorders
        WHERE ordermonth =&quot;,yyyy,mm, &quot; AND
        (idcompany IN (&quot;,companylist,&quot;))) b
    LEFT JOIN encrypt.anon_cardnum h ON b.SerialNumber = h.ticketserial
    LEFT JOIN odx.odx_&quot;,yyyy,mm,&quot; o ON h.hashed = o.card
    WHERE faretransactionkey &gt; 0
    --WHERE origin IS NOT NULL
) r&quot;))

taps &lt;- merge(taps, corporate_list, by = &quot;idcompany&quot;)
taps$uqtripid &lt;- paste(taps$idcompany, 
                             taps$serialnumber, 
                             day(taps$tap_time), 
                             taps$journey_sequence, 
                             sep = &quot;_&quot;)

taps$mode &lt;- if_else((as.numeric(taps$vehicle) &lt; 3000 | as.numeric(taps$vehicle) &gt; 3999), &quot;bus&quot;,
                     if_else((as.numeric(taps$vehicle) &gt; 2999 &amp; as.numeric(taps$vehicle) &lt; 4000), &quot;subway&quot;,
                             &quot;subway&quot;))

taps$mode[is.na(taps$mode)] &lt;- &quot;subway&quot;</code></pre>
<p><strong>Journey Legs</strong></p>
<p>The only way we can calculate distances and times for OD pairs is if we have both origins and destinations for a given OD pair. For the month of September 2018, the average inferred destination rate hovered around the 65% mark for all dates. This means, ODX could determine the destination for around 65% of taps. We therefore query to get a table of these inferred destinations. There are two types of mode or vehicle changes possible:</p>
<ol style="list-style-type: decimal">
<li>Behind the farebox (eg Red to Orange at Downtown Crossing)</li>
</ol>
<p>These are represented in the ‘rides’ column. These represent a vehicle change behind the faregates, and are inferred by the ODX model.</p>
<ol start="2" style="list-style-type: decimal">
<li>Crossing the farebox (eg Changing modes or buses)</li>
</ol>
<p>These are represented in the ‘stages’ column. These indicate a tap at a farebox or faregate.</p>
<p>Here too, all card level data is completely anonymized, and no individual can be identified with any of the card level information available at this aggregation level.</p>
<pre class="r"><code>legs &lt;- dbGetQuery(con, paste0(&quot;SELECT 
concat(r.IdCompany,&#39;_&#39;,r.SerialNumber,&#39;_&#39;,extract(day from on_time),&#39;_&#39;, journey_sequence) AS uqtripid
,r.IdCompany
,r.SerialNumber
,journey_sequence
,stage
,ride
,concat(stage,ride)::int AS journey_leg
,concat(on_stop, &#39;_&#39;, off_stop) AS uq_od_id
,on_stop AS o_stop_code
,ga.stop_name AS o_stop_name
,ga.stop_lat AS o_lat
,ga.stop_lon AS o_lon
,on_time AS origin_time
,off_stop AS d_stop_code
,gb.stop_name AS d_stop_name
,gb.stop_lat AS d_lat
,gb.stop_lon AS d_lon
,vehicle
FROM(
SELECT 
b.SerialNumber
,b.IdProduct
,b.IdCompany
,o.*
FROM (SELECT * FROM card_info.cardorders
WHERE ordermonth = &quot;,yyyy,mm,&quot; AND
(idcompany IN (&quot;,companylist,&quot;))) b
LEFT JOIN encrypt.anon_cardnum h ON b.SerialNumber = h.ticketserial
LEFT JOIN odx.rides_&quot;,yyyy,mm,&quot; o ON h.hashed = o.card) r 
LEFT JOIN gtfs.stops ga ON r.on_stop = ga.stop_code
LEFT JOIN gtfs.stops gb ON r.off_stop = gb.stop_code
WHERE
ga.valid_start_date = &#39;2018-09-06&#39;
AND gb.valid_end_date = &#39;2018-09-06&#39;
ORDER BY uqtripid, journey_leg&quot;))
legs &lt;- merge(legs, corporate_list, by = &quot;idcompany&quot;)

legs$mode &lt;- if_else(str_detect(string = legs$vehicle, pattern = &quot;^HR&quot;), &quot;subway&quot;,
                     if_else((as.numeric(legs$vehicle) &gt; 2999 &amp; as.numeric(legs$vehicle) &lt; 4000), &quot;subway&quot;,
                             &quot;bus&quot;))

# creating a unique OD pair ID - concatenation of the Origin latlong and Destination latlong. 
# Thsi is because the gmapsdistance creates a unique trip id based on these variables. It becomes easier to join tables later on:
legs$uqlatlongid &lt;- paste(legs$o_lat, 
                          legs$o_lon, 
                          legs$d_lat, 
                          legs$d_lon,
                          sep = &quot;+&quot;)</code></pre>
</div>
</div>
<div id="intermediate-tables-and-functions" class="section level2">
<h2>Intermediate Tables and Functions:</h2>
<p>Based on the data pulled with these SQL queries, we now work with it to ultimately generate our final output table.</p>
<div id="scaling-factor" class="section level3">
<h3>Scaling Factor:</h3>
<p>As mentioned in the section above, not all registered taps have an inferred destination. Thus with the assumption that these uninferred destinations are normally distributed across the system, we develop a scaling factor tailored to each company by mode.</p>
<p>The scaling factor is based on taps. This is the most definitive knowledge we have which is not inferred. We summarise the counts of taps by mode for every company.</p>
<p>We divide the total taps by the taps with an inferred destination. This will give us the scaling factor with which we will scale up our distance, time and emissions.</p>
<p>We also create a scalefactor table for cars. As one journey may contain more than one mode, we take the mean of the scalefactors for each company by mode.</p>
<pre class="r"><code>taps$uq_tap_id &lt;- paste(taps$idcompany, 
                        taps$serialnumber, 
                        day(taps$tap_time), 
                        taps$journey_sequence,
                        taps$stage,
                        sep = &quot;_&quot;)

taps$count &lt;- rep(1,nrow(taps))

total_taps &lt;- taps %&gt;% 
              dplyr::group_by(uq_tap_id) %&gt;% #groups by the unique tap ID.
              slice(c(1)) %&gt;% #takes only one of the multiple rows per tap. Since the vast majority of taps are by mode
              group_by(idcompany, companyname, mode) %&gt;% #selects the idcompany, companyname and mode columns, and groups the data acc to them
              summarise(total_tapcount = sum(count)) # summarises the counts by these three variables.



legs$uq_tap_id &lt;- paste(legs$idcompany, 
                        legs$serialnumber, 
                        day(legs$origin_time), 
                        legs$journey_sequence,
                        legs$stage,
                        sep = &quot;_&quot;)

legs$count &lt;- rep(1,nrow(legs))

odx_taps &lt;- legs %&gt;% 
            dplyr::group_by(uq_tap_id) %&gt;%  #groups by the unique tap ID.
            slice(c(1)) %&gt;% #takes only one of the multiple rows per tap. Since the vast majority of taps are by mode
            group_by(idcompany, companyname, mode) %&gt;% #selects the idcompany, companyname and mode columns, and groups the data acc to them
            summarise(odx_tapcount = sum(count)) # summarises the counts by these three variables.

scalefactor_tbl &lt;- merge(odx_taps,
                         total_taps,
                         by = c(&quot;idcompany&quot;,
                                &quot;companyname&quot;,
                                &quot;mode&quot;)
                         )

scalefactor_tbl$scalefactor &lt;- scalefactor_tbl$total_tapcount/scalefactor_tbl$odx_tapcount

scalefactor_cars &lt;- scalefactor_tbl %&gt;% 
                    group_by(idcompany,companyname) %&gt;% 
                    summarise(scalefactor = mean(scalefactor))</code></pre>
<div id="scale-factor-table-for-transit" class="section level4">
<h4>Scale Factor Table for Transit:</h4>
<pre class="r"><code>scalefactor_tbl</code></pre>
<pre><code>##    idcompany companyname   mode odx_tapcount total_tapcount scalefactor
## 1       1025   Company E    bus         2986           4300    1.440054
## 2       1025   Company E subway         4924           6107    1.240252
## 3      11078   Company P    bus          577            764    1.324090
## 4      11078   Company P subway         3057           3596    1.176317
## 5       1110   Company F    bus         1766           2687    1.521518
## 6       1110   Company F subway         4569           5700    1.247538
## 7       1136   Company N    bus          913           1147    1.256298
## 8       1136   Company N subway         2931           3556    1.213238
## 9       1709   Company B    bus          804           1125    1.399254
## 10      1709   Company B subway         2369           2947    1.243985
## 11      1762   Company L    bus         1020           1332    1.305882
## 12      1762   Company L subway         3808           4641    1.218750
## 13      1783   Company M    bus          827           1140    1.378476
## 14      1783   Company M subway         2566           3208    1.250195
## 15      1801   Company K    bus         1204           1750    1.453488
## 16      1801   Company K subway         1929           2687    1.392950
## 17      1840   Company I    bus          244            332    1.360656
## 18      1840   Company I subway         1273           1572    1.234878
## 19      1858   Company J    bus          581            794    1.366609
## 20      1858   Company J subway         2231           2736    1.226356
## 21      1904   Company A    bus          520            766    1.473077
## 22      1904   Company A subway         2005           2470    1.231920
## 23      1968   Company H    bus         1902           2861    1.504206
## 24      1968   Company H subway         1563           2067    1.322457
## 25      2456   Company O    bus         1646           2373    1.441677
## 26      2456   Company O subway         2362           3232    1.368332
## 27      3171   Company D    bus          866           1290    1.489607
## 28      3171   Company D subway         2523           3290    1.304003
## 29      3199   Company C    bus          646            880    1.362229
## 30      3199   Company C subway         3131           3923    1.252954
## 31      3480   Company G    bus          905           1158    1.279558
## 32      3480   Company G subway         4436           5322    1.199729
## 33      3574   Company Q    bus         1340           1975    1.473881
## 34      3574   Company Q subway         3679           5423    1.474042</code></pre>
</div>
<div id="scale-factor-table-for-cars" class="section level4">
<h4>Scale Factor Table for Cars:</h4>
<pre class="r"><code>scalefactor_cars</code></pre>
<pre><code>## # A tibble: 17 x 3
## # Groups:   idcompany [17]
##    idcompany companyname scalefactor
##        &lt;int&gt; &lt;chr&gt;             &lt;dbl&gt;
##  1      1025 Company E          1.34
##  2      1110 Company F          1.38
##  3      1136 Company N          1.23
##  4      1709 Company B          1.32
##  5      1762 Company L          1.26
##  6      1783 Company M          1.31
##  7      1801 Company K          1.42
##  8      1840 Company I          1.30
##  9      1858 Company J          1.30
## 10      1904 Company A          1.35
## 11      1968 Company H          1.41
## 12      2456 Company O          1.41
## 13      3171 Company D          1.40
## 14      3199 Company C          1.31
## 15      3480 Company G          1.24
## 16      3574 Company Q          1.47
## 17     11078 Company P          1.25</code></pre>
</div>
</div>
<div id="distinct-journeys" class="section level3">
<h3>Distinct Journeys:</h3>
<p>We already have a table where each row is indicative of a ‘leg’ in a journey. Each leg is a combination of the ‘stage’ and ‘ride’ columns. However, we are also calculating the equivalent distances, times, and emissions for cars for each of those journeys. Cars do not care for changes in legs of journeys, and only need to consider the absolute origin and destination for each journey. As such, we will need to create a table where each row corresponds to a journey. We can get this by filtering the ‘legs’ table by single leg journeys, and multi-leg journeys. We then format the multi-leg journeys so that the origin of the first leg, and the destination of the last leg are in the same row.</p>
<pre class="r"><code># filter out only multi-leg journeys, and get the first and last rows for each unique trip ID ie uqtripid. 
# Thus we get only two rows per journey:
multi_leg &lt;- legs %&gt;%
             dplyr::group_by(uqtripid) %&gt;% # grouping all rows by their unique trip ID, ie uqtripid
             slice(c(1, n())) %&gt;% # taking only the first and last leg
             distinct() %&gt;% # making sure they are distinct
             add_count() %&gt;% # adding a count of number of rows with same uqtripid
             filter(n&gt;1) # keeping only those rows with a count of more than 1

# shift all destination information &#39;up&#39; by one row. Thus the first row for each uniquetripID will have the absolute ends for each multitrip journey

multi_leg &lt;- cbind(data.frame(multi_leg[,c(1:13)],stringsAsFactors = F),
                   data.frame(data.frame(sapply(multi_leg[,c(14:17)],shift,n=1)) %&gt;% 
                                mutate(&quot;d_stop_code&quot; = as.numeric(as.character(d_stop_code)),
                                       &quot;d_stop_name&quot; = as.character(d_stop_name),
                                       &quot;d_lat&quot; = as.numeric(as.character(d_lat)),
                                       &quot;d_lon&quot; = as.numeric(as.character(d_lon)))), 
                   multi_leg[,c(18:21)],stringsAsFactors = F)

# remove the redundant second rows for every uqtripid.
multi_leg &lt;- multi_leg %&gt;%
             dplyr::group_by(uqtripid) %&gt;% # grouping all rows by their unique trip ID, ie uqtripid
             slice(1) %&gt;% # keeping only the first row, which now contains the first origin and last destination.
             distinct() %&gt;% 
             mutate(d_lat = as.numeric(d_lat), d_lon = as.numeric(d_lon)) # making the lat-long columns numeric. For some reason, they turn into factors.

# filter out all single-leg journeys, so we can bind the multi-leg journeys to create desired table.
single_leg &lt;- legs %&gt;%
              dplyr::group_by(uqtripid) %&gt;%  # grouping all rows by their unique trip ID, ie uqtripid
              slice(c(1, n())) %&gt;% # taking only the first and last rows of each unique trip ID.
              distinct() %&gt;% 
              add_count() %&gt;% # adding a count of number of rows with the same uqtripid
              filter(n==1) # keeping only those rows with a count equal to 1

# binding the now distinct single rows per journey together. We also remove redundant columns such as mode, vehicle type
distinctjourneys &lt;- bind_rows(multi_leg, single_leg) # merging these two table. As their column names and types are the same, we can do an bind_rows
distinctjourneys &lt;- distinctjourneys[,c(1:3,8:17,19,21)] # keeping only those rows which are useful for the gmapsdistance function.</code></pre>
<p>We will have to update the unique OD pair ID column as well as the unique LAT-LONG pair column to reflect the changes in the now condensed multi-leg journeys.</p>
<pre class="r"><code>distinctjourneys$uq_od_id &lt;- paste(distinctjourneys$o_stop_code, distinctjourneys$d_stop_code, sep = &quot;_&quot;)
distinctjourneys$uqlatlongid &lt;- paste(distinctjourneys$o_lat, 
                                      distinctjourneys$o_lon, 
                                      distinctjourneys$d_lat, 
                                      distinctjourneys$d_lon,
                                      sep = &quot;+&quot;)</code></pre>
</div>
<div id="function-gmapsdistance" class="section level3">
<h3>Function: GmapsDistance</h3>
<p>This is the main function with which we calculate the distances and times required to travel between our given OD pairs depending on what mode is specified. Here, we define and explain the variables and elements useful for this script. For a detailed documentation, check the <a href="https://cran.r-project.org/web/packages/gmapsdistance/gmapsdistance.pdf">CRAN page</a></p>
<p>The gmapsdistance function takes the following arguments:</p>
<p><strong>origin</strong></p>
<p>This is a string containing the origin. If a lat-long pair is supplied (as is in our case) the latitude and longitude must be a concatenation and separated by a “+” sign. For example:</p>
<pre class="r"><code>o_lat = 42.40577
o_lon = -71.14246

origin = &quot;42.40577+-71.14246&quot;</code></pre>
<p><strong>destination</strong></p>
<p>Similarly for the destination, it is a string containing the destination. If a lat-long pair is supplied (as is in our case) the latitude and longitude must be a concatenation and separated by a “+” sign. For example:</p>
<pre class="r"><code>d_lat = 42.32316
d_lon = -71.16619

destination = &quot;42.32316+-71.16619&quot;</code></pre>
<p><strong>combinations</strong></p>
<p>This describes how the pairing of OD pairs will happen while using the function. Since our OD pairs are on the same row, we select “pairwise”. To calculate between all origins and destination in the dataframe, we can use “all”. However, we do not require this.</p>
<pre class="r"><code>combinations = &quot;pairwise&quot;</code></pre>
<p><strong>mode</strong></p>
<p>This describes what mode of travel is to be used while calculating the distance and time. This is similar to how you can choose in the <a href="https://www.google.com/maps/preview">Google Maps</a> interface. Options available are: “bicycling”, “walking”, “transit” or “driving”</p>
<p>We use this function twice: once for driving, and then for transit.</p>
<pre class="r"><code>mode = &quot;transit&quot;

OR

mode = &quot;driving&quot;</code></pre>
<p><strong>arr_date</strong></p>
<p>This is the date of arrival at destination (in the YYYY-MM-DD format, for example 20th July 2017 would be written as 2017-07-20). We provide the date defined in the beginning as <code>funct_calldate</code></p>
<p><strong>arr_time</strong></p>
<p>This is the time of arrival at destination (in the HH:MM:SS format, for example 2:31:45 pm would be written as 14:31:45). We provide the time defined in the beginning as <code>funct_calltime</code></p>
<p><strong>key</strong></p>
<p>This is the Google API key defined in the begining. It is called by using the <code>get.api.key()</code> function.</p>
<p>Before running our function, we have to create two tables: One containing all the unique OD pair combinations for transit, and the other created for driving. We must note the following:</p>
<ol style="list-style-type: decimal">
<li><p>The transit table will reflect the number of unique OD pairs by legs. Each OD pair is equivalent to either a leg of a journey, or the whole journey itself, if the journey was a single-leg journey.</p></li>
<li><p>The driving table will reflect the number of unique OD pairs by journeys. Each OD pair is equivalent to only a journey. There may be an overlap with the transit table for single-leg journeys.</p></li>
</ol>
<p><strong>Transit Table</strong></p>
<pre class="r"><code>transittable &lt;- aggregate(uqtripid~uq_od_id+o_stop_code+o_stop_name+o_lat+o_lon+d_stop_code+d_stop_name+d_lat+d_lon+uqlatlongid, 
                          length, 
                          data = legs)</code></pre>
<pre><code>##        uq_od_id o_stop_code                    o_stop_name    o_lat
## 1   70239_70243       70239                     Prudential 42.34557
## 2    14150_2402       14150                       Lechmere 42.37102
## 3   70077_70091       70077              Downtown Crossing 42.35552
## 4   70079_70101       70079                  South Station 42.35227
## 5     2152_2155        2152     Concord Ave opp Fawcett St 42.38913
## 6   70204_70202       70204                      Haymarket 42.36302
## 7       1589_72        1589     Western Ave @ Riverdale St 42.36315
## 8   70020_70016       70020              Downtown Crossing 42.35552
## 9   70098_70078       70098                   North Quincy 42.27578
## 10    2578_2581        2578          Holland St @ Moore St 42.40248
## 11  70204_70197       70204                      Haymarket 42.36302
## 12   2060_20761        2060     Mt Auburn St @ Bigelow Ave 42.37119
## 13    5736_5740        5736     Meridian St @ Liverpool St 42.37409
## 14  70159_70187       70159                       Boylston 42.35321
## 15  70026_70004       70026                  North Station 42.36558
## 16  70015_70021       70015                       Back Bay 42.34735
## 17  70084_70082       70084                         Andrew 42.33015
## 18  70098_70072       70098                   North Quincy 42.27578
## 19    2778_2874        2778    Washington St opp Myrtle St 42.38158
## 20  70015_70027       70015                       Back Bay 42.34735
## 21  70078_70061       70078              Downtown Crossing 42.35552
## 22  70011_70013       70011                        Ruggles 42.33638
## 23  70069_70095       70069                        Central 42.36530
## 24  74611_74612       74611                  South Station 42.35227
## 25  70079_70097       70079                  South Station 42.35227
## 26  70210_70204       70210                       Lechmere 42.37096
## 27  70151_70137       70151                        Kenmore 42.34895
## 28  70034_70010       70034                  Malden Center 42.42669
## 29  70026_70002       70026                  North Station 42.36558
## 30  70199_70131       70199                    Park Street 42.35639
## 31  70160_70182       70160                      Riverside 42.33720
## 32  70042_70048       70042                   State Street 42.35898
## 33    110_14150         110 Massachusetts Ave @ Holyoke St 42.37326
## 34  70022_70018       70022                   State Street 42.35898
## 35   1363_10642        1363    Huntington Ave @ Fenwood Rd 42.33374
## 36  70021_70029       70021              Downtown Crossing 42.35552
## 37  70075_70081       70075                    Park Street 42.35639
## 38  70197_70229       70197                    Park Street 42.35639
## 39  70154_70202       70154                         Copley 42.34987
## 40  70060_70039       70060                     Wonderland 42.41513
## 41  70204_70239       70204                      Haymarket 42.36302
## 42  70086_70068       70086                      JFK/UMass 42.32055
## 43  70079_70095       70079                  South Station 42.35227
## 44  70003_70015       70003                   Green Street 42.31052
## 45  70011_70025       70011                        Ruggles 42.33638
## 46  70198_70155       70198                    Park Street 42.35639
## 47  70022_70014       70022                   State Street 42.35898
## 48      72_1775          72   Massachusetts Ave @ Pearl St 42.36492
## 49      884_892         884           Summer St @ E 1st St 42.33828
## 50    2228_2231        2228         Broadway @ Galileo Way 42.36449
## 51  70102_70080       70102                  Quincy Center 42.25181
## 52  70186_70158       70186                         Fenway 42.34527
## 53  70061_70071       70061                        Alewife 42.39543
## 54    1808_2755        1808            Park Dr @ Beacon St 42.34710
## 55    2874_2725        2874                Sullivan Square 42.38413
## 56   14150_2632       14150                       Lechmere 42.37102
## 57   2117_20761        2117     Belmont St @ St. Mary&#39;s St 42.37491
## 58  70248_70201       70248          Longwood Medical Area 42.33622
## 59      178_900         178 Saint James Ave @ Dartmouth St 42.34937
## 60  70210_70241       70210                       Lechmere 42.37096
## 61  70071_70101       70071                    Kendall/MIT 42.36236
## 62  70154_70158       70154                         Copley 42.34987
## 63  70061_70075       70061                        Alewife 42.39543
## 64  70088_70080       70088                     Savin Hill 42.31052
## 65  70102_70072       70102                  Quincy Center 42.25181
## 66  70065_70069       70065                         Porter 42.38840
## 67  70028_70024       70028              Community College 42.37407
## 68  70092_70078       70092                        Shawmut 42.29313
## 69    9201_9328        9201             Main St @ Essex St 42.45633
## 70  70202_70219       70202              Government Center 42.35970
## 71  70040_70050       70040              Government Center 42.35970
## 72  70069_70093       70069                        Central 42.36530
## 73   2134_20761        2134       Church St @ Lexington St 42.38719
## 74  70200_70210       70200                    Park Street 42.35639
## 75  70204_70219       70204                      Haymarket 42.36302
## 76  70011_70019       70011                        Ruggles 42.33638
## 77  70070_70066       70070                        Central 42.36538
## 78  70246_70240       70246            Museum of Fine Arts 42.33802
## 79     5284_117        5284           Salem St @ Almont St 42.42182
## 80  70186_70154       70186                         Fenway 42.34527
## 81  70156_70200       70156                      Arlington 42.35190
## 82  70023_70025       70023                   State Street 42.35898
## 83  70042_70050       70042                   State Street 42.35898
## 84  70202_70243       70202              Government Center 42.35970
## 85  70036_70016       70036                      Oak Grove 42.43750
## 86      284_150         284       E 8th St @ Old Harbor St 42.33129
## 87  49002_49003       49002           Tufts Medical Center 42.34969
## 88    9097_9328        9097          Grove St @ Lebanon St 42.45360
## 89  70096_70068       70096                      JFK/UMass 42.32056
## 90  70150_70200       70150                        Kenmore 42.34895
## 91  70082_70066       70082                       Broadway 42.34262
## 92  70186_70200       70186                         Fenway 42.34527
## 93  70011_70031       70011                        Ruggles 42.33638
## 94  70080_70078       70080                  South Station 42.35227
## 95    2376_5015        2376       Boston Ave @ Winthrop St 42.41140
## 96  70067_70069       70067                        Harvard 42.37336
## 97  70098_70064       70098                   North Quincy 42.27578
## 98  70020_70001       70020              Downtown Crossing 42.35552
## 99  70034_70026       70034                  Malden Center 42.42669
## 100 70154_70201       70154                         Copley 42.34987
##         o_lon d_stop_code                          d_stop_name    d_lat
## 1   -71.08170       70243              Northeastern University 42.33990
## 2   -71.07704        2402             Medford St @ Bartlett St 42.39424
## 3   -71.06023       70091                              Shawmut 42.29313
## 4   -71.05524       70101                        Quincy Center 42.25181
## 5   -71.14622        2155              Concord Ave opp Fern St 42.38595
## 6   -71.05829       70202                    Government Center 42.35970
## 7   -71.13204          72         Massachusetts Ave @ Pearl St 42.36492
## 8   -71.06023       70016                 Tufts Medical Center 42.34966
## 9   -71.03018       70078                    Downtown Crossing 42.35552
## 10  -71.12689        2581                Holland St @ Dover St 42.39693
## 11  -71.05829       70197                          Park Street 42.35639
## 12  -71.15796       20761                              Harvard 42.37336
## 13  -71.03914        5740                             Maverick 42.36914
## 14  -71.06454       70187                               Fenway 42.34509
## 15  -71.06129       70004                          Stony Brook 42.31706
## 16  -71.07573       70021                    Downtown Crossing 42.35552
## 17  -71.05765       70082                             Broadway 42.34262
## 18  -71.03018       70072                          Kendall/MIT 42.36243
## 19  -71.08404        2874                      Sullivan Square 42.38413
## 20  -71.07573       70027                        North Station 42.36558
## 21  -71.06023       70061                              Alewife 42.39543
## 22  -71.08896       70013                 Massachusetts Avenue 42.34051
## 23  -71.10362       70095                            JFK/UMass 42.32056
## 24  -71.05524       74612                           Courthouse 42.35245
## 25  -71.05524       70097                         North Quincy 42.27578
## 26  -71.07742       70204                            Haymarket 42.36302
## 27  -71.09517       70137                       Babcock Street 42.35190
## 28  -71.07438       70010                              Ruggles 42.33638
## 29  -71.06129       70002                         Green Street 42.31052
## 30  -71.06242       70131                       Harvard Avenue 42.35060
## 31  -71.25211       70182                             Longwood 42.34173
## 32  -71.05760       70048                              Airport 42.37426
## 33  -71.11812       14150                             Lechmere 42.37102
## 34  -71.05760       70018                            Chinatown 42.35255
## 35  -71.10572       10642                         Forest Hills 42.30075
## 36  -71.06023       70029                    Community College 42.37407
## 37  -71.06242       70081                             Broadway 42.34262
## 38  -71.06242       70229                    Washington Square 42.33947
## 39  -71.07805       70202                    Government Center 42.35970
## 40  -70.99121       70039                    Government Center 42.35970
## 41  -71.05829       70239                           Prudential 42.34557
## 42  -71.05245       70068                              Harvard 42.37336
## 43  -71.05524       70095                            JFK/UMass 42.32056
## 44  -71.10741       70015                             Back Bay 42.34735
## 45  -71.08896       70025                            Haymarket 42.36302
## 46  -71.06242       70155                               Copley 42.35013
## 47  -71.05760       70014                             Back Bay 42.34735
## 48  -71.10307        1775                  Park Dr @ Beacon St 42.34673
## 49  -71.03542         892           Summer St @ Dorchester Ave 42.35155
## 50  -71.08901        2231 Main St @ Kendall Station - Red Line 42.36250
## 51  -71.00541       70080                        South Station 42.35227
## 52  -71.10439       70158                             Boylston 42.35253
## 53  -71.14248       70071                          Kendall/MIT 42.36236
## 54  -71.10520        2755                  Green St @ Pearl St 42.36413
## 55  -71.07652        2725                 Broadway @ Temple St 42.39252
## 56  -71.07704        2632           Holland St opp Cameron Ave 42.40107
## 57  -71.15267       20761                              Harvard 42.37336
## 58  -71.09933       70201                    Government Center 42.35970
## 59  -71.07691         900                       Watertown Yard 42.36431
## 60  -71.07742       70241                             Symphony 42.34269
## 61  -71.08561       70101                        Quincy Center 42.25181
## 62  -71.07805       70158                             Boylston 42.35253
## 63  -71.14248       70075                          Park Street 42.35639
## 64  -71.05368       70080                        South Station 42.35227
## 65  -71.00541       70072                          Kendall/MIT 42.36243
## 66  -71.11915       70069                              Central 42.36530
## 67  -71.07093       70024                            Haymarket 42.36302
## 68  -71.06574       70078                    Downtown Crossing 42.35552
## 69  -71.06462        9328                     Oak Grove Busway 42.43681
## 70  -71.05921       70219                      Coolidge Corner 42.34227
## 71  -71.05921       70050                          Wood Island 42.37964
## 72  -71.10362       70093                              Ashmont 42.28449
## 73  -71.19061       20761                              Harvard 42.37336
## 74  -71.06242       70210                             Lechmere 42.37096
## 75  -71.05829       70219                      Coolidge Corner 42.34227
## 76  -71.08896       70019                            Chinatown 42.35255
## 77  -71.10355       70066                               Porter 42.38840
## 78  -71.09468       70240                           Prudential 42.34557
## 79  -71.09591         117          Congress St @ Haymarket Sta 42.36185
## 80  -71.10439       70154                               Copley 42.34987
## 81  -71.07089       70200                          Park Street 42.35639
## 82  -71.05760       70025                            Haymarket 42.36302
## 83  -71.05760       70050                          Wood Island 42.37964
## 84  -71.05921       70243              Northeastern University 42.33990
## 85  -71.07071       70016                 Tufts Medical Center 42.34966
## 86  -71.04730         150          Broadway Station - Red Line 42.34265
## 87  -71.06382       49003            Washington St @ Herald St 42.34646
## 88  -71.05957        9328                     Oak Grove Busway 42.43681
## 89  -71.05225       70068                              Harvard 42.37336
## 90  -71.09517       70200                          Park Street 42.35639
## 91  -71.05697       70066                               Porter 42.38840
## 92  -71.10439       70200                          Park Street 42.35639
## 93  -71.08896       70031                      Sullivan Square 42.38397
## 94  -71.05524       70078                    Downtown Crossing 42.35552
## 95  -71.12167        5015           College Ave @ Highland Ave 42.39680
## 96  -71.11896       70069                              Central 42.36530
## 97  -71.03018       70064                                Davis 42.39674
## 98  -71.06023       70001                         Forest Hills 42.30052
## 99  -71.07438       70026                        North Station 42.36558
## 100 -71.07805       70201                    Government Center 42.35970
##         d_lon                                   uqlatlongid uqtripid
## 1   -71.09021       42.34557+-71.081696+42.339897+-71.09021       13
## 2   -71.10188      42.371019+-71.077039+42.39424+-71.101882       32
## 3   -71.06574 42.355518+-71.060225+42.29312583+-71.06573796       75
## 4   -71.00541     42.352271+-71.055242+42.251809+-71.005409       52
## 5   -71.13900     42.389131+-71.146219+42.385954+-71.139005       10
## 6   -71.05921      42.363021+-71.05829+42.359705+-71.059215       22
## 7   -71.10307     42.363148+-71.132038+42.364915+-71.103074       22
## 8   -71.06392     42.355518+-71.060225+42.349662+-71.063917       30
## 9   -71.06023     42.275783+-71.030184+42.355518+-71.060225      119
## 10  -71.12297      42.402484+-71.126893+42.39693+-71.122971       10
## 11  -71.06242   42.363021+-71.05829+42.35639457+-71.0624242       28
## 12  -71.11896     42.371186+-71.157955+42.373362+-71.118956       21
## 13  -71.03961      42.37409+-71.039143+42.369139+-71.039615       13
## 14  -71.10484     42.353214+-71.064545+42.345088+-71.104843       35
## 15  -71.10425      42.365577+-71.06129+42.317062+-71.104248       17
## 16  -71.06023      42.34735+-71.075727+42.355518+-71.060225      109
## 17  -71.05697     42.330154+-71.057655+42.342622+-71.056967       11
## 18  -71.08559     42.275783+-71.030184+42.362434+-71.085591      182
## 19  -71.07652     42.381576+-71.084037+42.384129+-71.076515       10
## 20  -71.06129       42.34735+-71.075727+42.365577+-71.06129       60
## 21  -71.14248     42.355518+-71.060225+42.395428+-71.142483      337
## 22  -71.08373     42.336377+-71.088961+42.340505+-71.083733       21
## 23  -71.05231     42.365304+-71.103621+42.320557+-71.052312       12
## 24  -71.04685       42.352271+-71.055242+42.35245+-71.04685       65
## 25  -71.03018     42.352271+-71.055242+42.275783+-71.030184      142
## 26  -71.05829      42.370958+-71.077416+42.363021+-71.05829       67
## 27  -71.12204     42.348949+-71.095169+42.351903+-71.122042       12
## 28  -71.08896     42.426694+-71.074379+42.336377+-71.088961       44
## 29  -71.10741      42.365577+-71.06129+42.310525+-71.107414       17
## 30  -71.13073  42.35639457+-71.0624242+42.350602+-71.130727       12
## 31  -71.10986     42.337197+-71.252108+42.341731+-71.109856       13
## 32  -71.03039     42.358978+-71.057598+42.374262+-71.030395       70
## 33  -71.07704     42.373259+-71.118124+42.371019+-71.077039       10
## 34  -71.06275     42.358978+-71.057598+42.352547+-71.062752       14
## 35  -71.11431     42.333739+-71.105717+42.300749+-71.114314       14
## 36  -71.07093     42.355518+-71.060225+42.374067+-71.070929      180
## 37  -71.05697  42.35639457+-71.0624242+42.342622+-71.056967      124
## 38  -71.13514  42.35639457+-71.0624242+42.339471+-71.135139       14
## 39  -71.05921     42.349871+-71.078049+42.359705+-71.059215       37
## 40  -71.05921     42.415135+-70.991207+42.359705+-71.059215      122
## 41  -71.08170       42.363021+-71.05829+42.34557+-71.081696       16
## 42  -71.11896     42.320547+-71.052449+42.373362+-71.118956       15
## 43  -71.05231     42.352271+-71.055242+42.320557+-71.052312       47
## 44  -71.07573      42.310525+-71.107414+42.34735+-71.075727       25
## 45  -71.05829      42.336377+-71.088961+42.363021+-71.05829       14
## 46  -71.07738  42.35639457+-71.0624242+42.350126+-71.077376      182
## 47  -71.07573      42.358978+-71.057598+42.34735+-71.075727      113
## 48  -71.10526     42.364915+-71.103074+42.346727+-71.105259       31
## 49  -71.05296      42.33828+-71.035424+42.351549+-71.052959       40
## 50  -71.08584     42.364487+-71.089007+42.362498+-71.085841       16
## 51  -71.05524     42.251809+-71.005409+42.352271+-71.055242       76
## 52  -71.06468     42.345272+-71.104392+42.352531+-71.064682       47
## 53  -71.08561     42.395428+-71.142483+42.362355+-71.085605      618
## 54  -71.10303       42.3471+-71.105198+42.364128+-71.103034       17
## 55  -71.09297     42.384129+-71.076515+42.392521+-71.092975       24
## 56  -71.12609     42.371019+-71.077039+42.401071+-71.126094       13
## 57  -71.11896       42.37491+-71.15267+42.373362+-71.118956       38
## 58  -71.05921     42.336217+-71.099328+42.359705+-71.059215       17
## 59  -71.18570     42.349373+-71.076911+42.364307+-71.185703       39
## 60  -71.08506     42.370958+-71.077416+42.342687+-71.085056       23
## 61  -71.00541     42.362355+-71.085605+42.251809+-71.005409       76
## 62  -71.06468     42.349871+-71.078049+42.352531+-71.064682       30
## 63  -71.06242  42.395428+-71.142483+42.35639457+-71.0624242      202
## 64  -71.05524     42.310516+-71.053682+42.352271+-71.055242       28
## 65  -71.08559     42.251809+-71.005409+42.362434+-71.085591       82
## 66  -71.10362       42.3884+-71.119149+42.365304+-71.103621      120
## 67  -71.05829      42.374067+-71.070929+42.363021+-71.05829       25
## 68  -71.06023 42.29312583+-71.06573796+42.355518+-71.060225       78
## 69  -71.07034     42.456326+-71.064624+42.436807+-71.070338       15
## 70  -71.12091     42.359705+-71.059215+42.342274+-71.120915       19
## 71  -71.02280     42.359705+-71.059215+42.379642+-71.022801       12
## 72  -71.06388      42.365304+-71.103621+42.28449+-71.063878       29
## 73  -71.11896     42.387194+-71.190609+42.373362+-71.118956       10
## 74  -71.07742  42.35639457+-71.0624242+42.370958+-71.077416      313
## 75  -71.12091      42.363021+-71.05829+42.342274+-71.120915       13
## 76  -71.06275     42.336377+-71.088961+42.352547+-71.062752       36
## 77  -71.11915       42.365379+-71.103554+42.3884+-71.119149      152
## 78  -71.08170      42.338017+-71.094682+42.34557+-71.081696       13
## 79  -71.05772     42.421821+-71.095905+42.361847+-71.057724       15
## 80  -71.07805     42.345272+-71.104392+42.349871+-71.078049      112
## 81  -71.06242  42.351902+-71.070893+42.35639457+-71.0624242       74
## 82  -71.05829      42.358978+-71.057598+42.363021+-71.05829       17
## 83  -71.02280     42.358978+-71.057598+42.379642+-71.022801       16
## 84  -71.09021      42.359705+-71.059215+42.339897+-71.09021       12
## 85  -71.06392     42.437501+-71.070706+42.349662+-71.063917       11
## 86  -71.05706     42.331286+-71.047299+42.342652+-71.057065       12
## 87  -71.06470     42.349686+-71.063818+42.346457+-71.064695       10
## 88  -71.07034     42.453596+-71.059566+42.436807+-71.070338       13
## 89  -71.11896     42.320563+-71.052251+42.373362+-71.118956       16
## 90  -71.06242  42.348949+-71.095169+42.35639457+-71.0624242      214
## 91  -71.11915       42.342622+-71.056967+42.3884+-71.119149       13
## 92  -71.06242  42.345272+-71.104392+42.35639457+-71.0624242      193
## 93  -71.07699     42.336377+-71.088961+42.383975+-71.076994       41
## 94  -71.06023     42.352271+-71.055242+42.355518+-71.060225      198
## 95  -71.12217     42.411399+-71.121671+42.396803+-71.122171       24
## 96  -71.10362     42.373362+-71.118956+42.365304+-71.103621      155
## 97  -71.12181      42.275783+-71.030184+42.39674+-71.121815       20
## 98  -71.11369     42.355518+-71.060225+42.300523+-71.113686      218
## 99  -71.06129      42.426694+-71.074379+42.365577+-71.06129       41
## 100 -71.05921     42.349871+-71.078049+42.359705+-71.059215       99</code></pre>
<p><strong>Driving Table</strong></p>
<pre class="r"><code>drivingtable &lt;- aggregate(uqtripid~uq_od_id+o_stop_code+o_stop_name+o_lat+o_lon+d_stop_code+d_stop_name+d_lat+d_lon+uqlatlongid, 
                          length, 
                          data = distinctjourneys)</code></pre>
<pre><code>##        uq_od_id o_stop_code                        o_stop_name    o_lat
## 1    2683_14150        2683            Highland Ave @ Trull Ln 42.38762
## 2   70045_70157       70045                           Maverick 42.36912
## 3   70071_70075       70071                        Kendall/MIT 42.36236
## 4   70067_70131       70067                            Harvard 42.37336
## 5   70044_70048       70044                           Aquarium 42.35978
## 6   14150_26131       14150                           Lechmere 42.37102
## 7   70044_70052       70044                           Aquarium 42.35978
## 8   70013_70021       70013               Massachusetts Avenue 42.34051
## 9    2699_14150        2699 Broadway @ Hinckley St - Magoun Sq 42.39754
## 10  70154_70085       70154                             Copley 42.34987
## 11  70150_70156       70150                            Kenmore 42.34895
## 12  70015_70019       70015                           Back Bay 42.34735
## 13   2384_14150        2384           Medford St @ Bartlett St 42.39393
## 14  70098_70207       70098                       North Quincy 42.27578
## 15  70065_70071       70065                             Porter 42.38840
## 16    14150_110       14150                           Lechmere 42.37102
## 17  70102_70155       70102                      Quincy Center 42.25181
## 18  70078_70074       70078                  Downtown Crossing 42.35552
## 19  70076_70061       70076                        Park Street 42.35639
## 20  70063_70187       70063                              Davis 42.39674
## 21  70021_70033       70021                  Downtown Crossing 42.35552
## 22  70086_70068       70086                          JFK/UMass 42.32055
## 23  70278_70028       70278                           Assembly 42.39234
## 24  70065_70067       70065                             Porter 42.38840
## 25  70036_70026       70036                          Oak Grove 42.43750
## 26        72_79          72       Massachusetts Ave @ Pearl St 42.36492
## 27  70007_70011       70007                     Jackson Square 42.32313
## 28  70210_70199       70210                           Lechmere 42.37096
## 29   2849_30203        2849         Bunker Hill St @ School St 42.37906
## 30  70157_70151       70157                          Arlington 42.35190
## 31  70047_70210       70047                            Airport 42.37426
## 32  70055_70041       70055                          Beachmont 42.39720
## 33  70156_70064       70156                          Arlington 42.35190
## 34  70084_70210       70084                             Andrew 42.33015
## 35   2698_14150        2698                Broadway @ Cedar St 42.39837
## 36  70040_70048       70040                  Government Center 42.35970
## 37  70047_70041       70047                            Airport 42.37426
## 38   2595_14150        2595        Somerville Ave @ Carlton St 42.38118
## 39  70015_70021       70015                           Back Bay 42.34735
## 40  70006_70001       70006                     Jackson Square 42.32313
## 41  70250_70205       70250                     Brigham Circle 42.33485
## 42  70077_70105       70077                  Downtown Crossing 42.35552
## 43  70094_70074       70094                            Ashmont 42.28453
## 44  70011_70091       70011                            Ruggles 42.33638
## 45   14150_1425       14150                           Lechmere 42.37102
## 46  70026_70002       70026                      North Station 42.36558
## 47  70023_70035       70023                       State Street 42.35898
## 48   1808_70064        1808                Park Dr @ Beacon St 42.34710
## 49  70209_70199       70209                           Lechmere 42.37114
## 50  70075_70097       70075                        Park Street 42.35639
## 51    285_70072         285               E 8th St @ Mercer St 42.33149
## 52  70047_70039       70047                            Airport 42.37426
## 53  70152_70241       70152            Hynes Convention Center 42.34789
## 54      72_9434          72       Massachusetts Ave @ Pearl St 42.36492
## 55  70130_70199       70130                     Harvard Avenue 42.35026
## 56  70074_70072       70074                        Charles/MGH 42.36127
## 57  70065_70079       70065                             Porter 42.38840
## 58  70084_70072       70084                             Andrew 42.33015
## 59  70045_70043       70045                           Maverick 42.36912
## 60   6538_49003        6538            Essex St @ Atlantic Ave 42.35176
## 61   2684_14150        2684           Highland Ave @ School St 42.38681
## 62  70025_70036       70025                          Haymarket 42.36302
## 63  70104_70078       70104                       Quincy Adams 42.23339
## 64  70186_70202       70186                             Fenway 42.34527
## 65  70028_70020       70028                  Community College 42.37407
## 66  70042_70048       70042                       State Street 42.35898
## 67  70183_70160       70183                           Longwood 42.34159
## 68  70034_70016       70034                      Malden Center 42.42669
## 69  70094_70072       70094                            Ashmont 42.28453
## 70    2030_2118        2030           Mt Auburn St @ Homer Ave 42.37497
## 71  70126_70199       70126                     Allston Street 42.34865
## 72  70098_70064       70098                       North Quincy 42.27578
## 73  70186_70200       70186                             Fenway 42.34527
## 74  70066_70061       70066                             Porter 42.38840
## 75  70210_70208       70210                           Lechmere 42.37096
## 76  70022_70004       70022                       State Street 42.35898
## 77  70007_70021       70007                     Jackson Square 42.32313
## 78    16535_885       16535                Otis St @ Summer St 42.35424
## 79  70065_70210       70065                             Porter 42.38840
## 80  70055_70155       70055                          Beachmont 42.39720
## 81  70279_70036       70279                           Assembly 42.39234
## 82  70070_70066       70070                            Central 42.36538
## 83  70150_70152       70150                            Kenmore 42.34895
## 84  70158_70070       70158                           Boylston 42.35253
## 85   2688_14150        2688          Medford St @ Highland Ave 42.38397
## 86  70071_74613       70071                        Kendall/MIT 42.36236
## 87  70061_70077       70061                            Alewife 42.39543
## 88  70186_70158       70186                             Fenway 42.34527
## 89  70210_70035       70210                           Lechmere 42.37096
## 90  70007_70019       70007                     Jackson Square 42.32313
## 91  70044_70060       70044                           Aquarium 42.35978
## 92      178_900         178     Saint James Ave @ Dartmouth St 42.34937
## 93  70069_70131       70069                            Central 42.36530
## 94  70028_70004       70028                  Community College 42.37407
## 95  70069_70089       70069                            Central 42.36530
## 96  70063_70091       70063                              Davis 42.39674
## 97  11802_70064       11802   Ave Louis Pasteur @ Longwood Ave 42.33847
## 98  70027_70036       70027                      North Station 42.36558
## 99   14150_2618       14150                           Lechmere 42.37102
## 100 70071_70033       70071                        Kendall/MIT 42.36236
##         o_lon d_stop_code                    d_stop_name    d_lat
## 1   -71.10125       14150                       Lechmere 42.37102
## 2   -71.03953       70157                      Arlington 42.35190
## 3   -71.08561       70075                    Park Street 42.35639
## 4   -71.11896       70131                 Harvard Avenue 42.35060
## 5   -71.05165       70048                        Airport 42.37426
## 6   -71.07704       26131            Bow St @ Warren Ave 42.38027
## 7   -71.05165       70052                 Orient Heights 42.38693
## 8   -71.08373       70021              Downtown Crossing 42.35552
## 9   -71.10519       14150                       Lechmere 42.37102
## 10  -71.07805       70085                      JFK/UMass 42.32055
## 11  -71.09517       70156                      Arlington 42.35190
## 12  -71.07573       70019                      Chinatown 42.35255
## 13  -71.10179       14150                       Lechmere 42.37102
## 14  -71.03018       70207                   Science Park 42.36693
## 15  -71.11915       70071                    Kendall/MIT 42.36236
## 16  -71.07704         110 Massachusetts Ave @ Holyoke St 42.37326
## 17  -71.00541       70155                         Copley 42.35013
## 18  -71.06023       70074                    Charles/MGH 42.36127
## 19  -71.06242       70061                        Alewife 42.39543
## 20  -71.12181       70187                         Fenway 42.34509
## 21  -71.06023       70033                     Wellington 42.40132
## 22  -71.05245       70068                        Harvard 42.37336
## 23  -71.07727       70028              Community College 42.37407
## 24  -71.11915       70067                        Harvard 42.37336
## 25  -71.07071       70026                  North Station 42.36558
## 26  -71.10307          79 Massachusetts Ave @ Newbury St 42.34794
## 27  -71.09959       70011                        Ruggles 42.33638
## 28  -71.07742       70199                    Park Street 42.35639
## 29  -71.06299       30203     Congress St opp Hanover St 42.36110
## 30  -71.07089       70151                        Kenmore 42.34895
## 31  -71.03039       70210                       Lechmere 42.37096
## 32  -70.99257       70041                   State Street 42.35898
## 33  -71.07089       70064                          Davis 42.39674
## 34  -71.05765       70210                       Lechmere 42.37096
## 35  -71.10781       14150                       Lechmere 42.37102
## 36  -71.05921       70048                        Airport 42.37426
## 37  -71.03039       70041                   State Street 42.35898
## 38  -71.09968       14150                       Lechmere 42.37102
## 39  -71.07573       70021              Downtown Crossing 42.35552
## 40  -71.09959       70001                   Forest Hills 42.30052
## 41  -71.10302       70205                  North Station 42.36558
## 42  -71.06023       70105                      Braintree 42.20748
## 43  -71.06372       70074                    Charles/MGH 42.36127
## 44  -71.08896       70091                        Shawmut 42.29313
## 45  -71.07704        1425  Cambridge St @ Springfield St 42.37372
## 46  -71.06129       70002                   Green Street 42.31052
## 47  -71.05760       70035                  Malden Center 42.42668
## 48  -71.10520       70064                          Davis 42.39674
## 49  -71.07730       70199                    Park Street 42.35639
## 50  -71.06242       70097                   North Quincy 42.27578
## 51  -71.04889       70072                    Kendall/MIT 42.36243
## 52  -71.03039       70039              Government Center 42.35970
## 53  -71.08790       70241                       Symphony 42.34269
## 54  -71.10307        9434           Park Dr @ Fenway Sta 42.34530
## 55  -71.13130       70199                    Park Street 42.35639
## 56  -71.07168       70072                    Kendall/MIT 42.36243
## 57  -71.11915       70079                  South Station 42.35227
## 58  -71.05765       70072                    Kendall/MIT 42.36243
## 59  -71.03953       70043                       Aquarium 42.35978
## 60  -71.05600       49003      Washington St @ Herald St 42.34646
## 61  -71.09886       14150                       Lechmere 42.37102
## 62  -71.05829       70036                      Oak Grove 42.43750
## 63  -71.00715       70078              Downtown Crossing 42.35552
## 64  -71.10439       70202              Government Center 42.35970
## 65  -71.07093       70020              Downtown Crossing 42.35552
## 66  -71.05760       70048                        Airport 42.37426
## 67  -71.11012       70160                      Riverside 42.33720
## 68  -71.07438       70016           Tufts Medical Center 42.34966
## 69  -71.06372       70072                    Kendall/MIT 42.36243
## 70  -71.14831        2118        Belmont St @ Cushing St 42.37492
## 71  -71.13788       70199                    Park Street 42.35639
## 72  -71.03018       70064                          Davis 42.39674
## 73  -71.10439       70200                    Park Street 42.35639
## 74  -71.11915       70061                        Alewife 42.39543
## 75  -71.07742       70208                   Science Park 42.36661
## 76  -71.05760       70004                    Stony Brook 42.31706
## 77  -71.09959       70021              Downtown Crossing 42.35552
## 78  -71.05856         885           Summer St @ E 1st St 42.33821
## 79  -71.11915       70210                       Lechmere 42.37096
## 80  -70.99257       70155                         Copley 42.35013
## 81  -71.07727       70036                      Oak Grove 42.43750
## 82  -71.10355       70066                         Porter 42.38840
## 83  -71.09517       70152        Hynes Convention Center 42.34789
## 84  -71.06468       70070                        Central 42.36538
## 85  -71.09210       14150                       Lechmere 42.37102
## 86  -71.08561       74613             World Trade Center 42.34863
## 87  -71.14248       70077              Downtown Crossing 42.35552
## 88  -71.10439       70158                       Boylston 42.35253
## 89  -71.07742       70035                  Malden Center 42.42668
## 90  -71.09959       70019                      Chinatown 42.35255
## 91  -71.05165       70060                     Wonderland 42.41513
## 92  -71.07691         900                 Watertown Yard 42.36431
## 93  -71.10362       70131                 Harvard Avenue 42.35060
## 94  -71.07093       70004                    Stony Brook 42.31706
## 95  -71.10362       70089                  Fields Corner 42.30004
## 96  -71.12181       70091                        Shawmut 42.29313
## 97  -71.10233       70064                          Davis 42.39674
## 98  -71.06129       70036                      Oak Grove 42.43750
## 99  -71.07704        2618    Somerville Ave @ Central St 42.38339
## 100 -71.08561       70033                     Wellington 42.40132
##         d_lon                                   uqlatlongid uqtripid
## 1   -71.07704     42.387616+-71.101254+42.371019+-71.077039       13
## 2   -71.07089 42.36911856+-71.03952958+42.351902+-71.070893       14
## 3   -71.06242  42.362355+-71.085605+42.35639457+-71.0624242      101
## 4   -71.13073     42.373362+-71.118956+42.350602+-71.130727       10
## 5   -71.03039     42.359784+-71.051652+42.374262+-71.030395       52
## 6   -71.09662     42.371019+-71.077039+42.380273+-71.096622       20
## 7   -71.00477     42.359784+-71.051652+42.386933+-71.004769       19
## 8   -71.06023     42.340505+-71.083733+42.355518+-71.060225       29
## 9   -71.07704     42.397544+-71.105186+42.371019+-71.077039       21
## 10  -71.05252     42.349871+-71.078049+42.320549+-71.052521       14
## 11  -71.07089     42.348949+-71.095169+42.351902+-71.070893       20
## 12  -71.06275      42.34735+-71.075727+42.352547+-71.062752       12
## 13  -71.07704     42.393932+-71.101792+42.371019+-71.077039       15
## 14  -71.06809     42.275783+-71.030184+42.366933+-71.068093       10
## 15  -71.08561       42.3884+-71.119149+42.362355+-71.085605      348
## 16  -71.11812     42.371019+-71.077039+42.373259+-71.118124       26
## 17  -71.07738     42.251809+-71.005409+42.350126+-71.077376       18
## 18  -71.07168     42.355518+-71.060225+42.361269+-71.071678       36
## 19  -71.14248  42.35639457+-71.0624242+42.395428+-71.142483       43
## 20  -71.10484      42.39674+-71.121815+42.345088+-71.104843       11
## 21  -71.07673      42.355518+-71.060225+42.401322+-71.07673      121
## 22  -71.11896     42.320547+-71.052449+42.373362+-71.118956       13
## 23  -71.07093     42.392342+-71.077272+42.374067+-71.070929       72
## 24  -71.11896       42.3884+-71.119149+42.373362+-71.118956       51
## 25  -71.06129      42.437501+-71.070706+42.365577+-71.06129       27
## 26  -71.08815     42.364915+-71.103074+42.347937+-71.088146       13
## 27  -71.08896     42.323132+-71.099592+42.336377+-71.088961       24
## 28  -71.06242  42.370958+-71.077416+42.35639457+-71.0624242       36
## 29  -71.05763     42.379056+-71.062991+42.361096+-71.057627       10
## 30  -71.09517     42.351902+-71.070893+42.348949+-71.095169       16
## 31  -71.07742     42.374262+-71.030395+42.370958+-71.077416       24
## 32  -71.05760     42.397195+-70.992569+42.358978+-71.057598       77
## 33  -71.12181      42.351902+-71.070893+42.39674+-71.121815       10
## 34  -71.07742     42.330154+-71.057655+42.370958+-71.077416       21
## 35  -71.07704      42.398373+-71.10781+42.371019+-71.077039       16
## 36  -71.03039     42.359705+-71.059215+42.374262+-71.030395       16
## 37  -71.05760     42.374262+-71.030395+42.358978+-71.057598       45
## 38  -71.07704     42.381176+-71.099677+42.371019+-71.077039       18
## 39  -71.06023      42.34735+-71.075727+42.355518+-71.060225       43
## 40  -71.11369     42.323132+-71.099592+42.300523+-71.113686       18
## 41  -71.06129      42.334846+-71.103017+42.365577+-71.06129       17
## 42  -71.00164      42.355518+-71.060225+42.207481+-71.00164       15
## 43  -71.07168     42.284528+-71.063717+42.361269+-71.071678       51
## 44  -71.06574 42.336377+-71.088961+42.29312583+-71.06573796       16
## 45  -71.10037     42.371019+-71.077039+42.373716+-71.100371       26
## 46  -71.10741      42.365577+-71.06129+42.310525+-71.107414       16
## 47  -71.07432     42.358978+-71.057598+42.426682+-71.074317       92
## 48  -71.12181        42.3471+-71.105198+42.39674+-71.121815       16
## 49  -71.06242  42.371141+-71.077298+42.35639457+-71.0624242       63
## 50  -71.03018  42.35639457+-71.0624242+42.275783+-71.030184       20
## 51  -71.08559     42.331495+-71.048888+42.362434+-71.085591       10
## 52  -71.05921     42.374262+-71.030395+42.359705+-71.059215       14
## 53  -71.08506     42.347888+-71.087903+42.342687+-71.085056       11
## 54  -71.10456     42.364915+-71.103074+42.345304+-71.104558       15
## 55  -71.06242  42.350263+-71.131298+42.35639457+-71.0624242       19
## 56  -71.08559     42.361269+-71.071678+42.362434+-71.085591      103
## 57  -71.05524       42.3884+-71.119149+42.352271+-71.055242       30
## 58  -71.08559     42.330154+-71.057655+42.362434+-71.085591       66
## 59  -71.05165 42.36911856+-71.03952958+42.359784+-71.051652       81
## 60  -71.06470      42.35176+-71.056003+42.346457+-71.064695       14
## 61  -71.07704     42.386815+-71.098864+42.371019+-71.077039       16
## 62  -71.07071      42.363021+-71.05829+42.437501+-71.070706       20
## 63  -71.06023     42.233391+-71.007153+42.355518+-71.060225       68
## 64  -71.05921     42.345272+-71.104392+42.359705+-71.059215       73
## 65  -71.06023     42.374067+-71.070929+42.355518+-71.060225       65
## 66  -71.03039     42.358978+-71.057598+42.374262+-71.030395       36
## 67  -71.25211     42.341589+-71.110117+42.337197+-71.252108       12
## 68  -71.06392     42.426694+-71.074379+42.349662+-71.063917       24
## 69  -71.08559     42.284528+-71.063717+42.362434+-71.085591      111
## 70  -71.15151     42.374974+-71.148307+42.374923+-71.151511       12
## 71  -71.06242  42.348649+-71.137881+42.35639457+-71.0624242       10
## 72  -71.12181      42.275783+-71.030184+42.39674+-71.121815       19
## 73  -71.06242  42.345272+-71.104392+42.35639457+-71.0624242       35
## 74  -71.14248       42.3884+-71.119149+42.395428+-71.142483       23
## 75  -71.06764     42.370958+-71.077416+42.366609+-71.067636       21
## 76  -71.10425     42.358978+-71.057598+42.317062+-71.104248       30
## 77  -71.06023     42.323132+-71.099592+42.355518+-71.060225       41
## 78  -71.03555     42.354243+-71.058557+42.338215+-71.035547       13
## 79  -71.07742       42.3884+-71.119149+42.370958+-71.077416       12
## 80  -71.07738     42.397195+-70.992569+42.350126+-71.077376       12
## 81  -71.07071     42.392342+-71.077272+42.437501+-71.070706       19
## 82  -71.11915       42.365379+-71.103554+42.3884+-71.119149      114
## 83  -71.08790     42.348949+-71.095169+42.347888+-71.087903       28
## 84  -71.10355     42.352531+-71.064682+42.365379+-71.103554       10
## 85  -71.07704     42.383968+-71.092101+42.371019+-71.077039       17
## 86  -71.04246       42.362355+-71.085605+42.34863+-71.04246       10
## 87  -71.06023     42.395428+-71.142483+42.355518+-71.060225      273
## 88  -71.06468     42.345272+-71.104392+42.352531+-71.064682       21
## 89  -71.07432     42.370958+-71.077416+42.426682+-71.074317       11
## 90  -71.06275     42.323132+-71.099592+42.352547+-71.062752       17
## 91  -70.99121     42.359784+-71.051652+42.415135+-70.991207       30
## 92  -71.18570     42.349373+-71.076911+42.364307+-71.185703       28
## 93  -71.13073     42.365304+-71.103621+42.350602+-71.130727       10
## 94  -71.10425     42.374067+-71.070929+42.317062+-71.104248       25
## 95  -71.06187     42.365304+-71.103621+42.300045+-71.061868       10
## 96  -71.06574  42.39674+-71.121815+42.29312583+-71.06573796       10
## 97  -71.12181      42.338473+-71.102334+42.39674+-71.121815       12
## 98  -71.07071      42.365577+-71.06129+42.437501+-71.070706       25
## 99  -71.10706     42.371019+-71.077039+42.383388+-71.107062       14
## 100 -71.07673      42.362355+-71.085605+42.401322+-71.07673       22</code></pre>
<p><strong>Running the gmapsdistance function</strong></p>
<pre class="r"><code>tr_matrix &lt;- gmapsdistance(
  origin = paste(transittable$o_lat, transittable$o_lon, sep = &quot;+&quot;),
  destination = paste(transittable$d_lat, transittable$d_lon, sep = &quot;+&quot;),
  combinations = &quot;pairwise&quot;,
  mode = &quot;transit&quot;,
  arr_date = as.character(funct_calldate),
  arr_time = as.character(funct_calltime),
  key = get.api.key()
)

dr_matrix &lt;- gmapsdistance(
  origin = paste(drivingtable$o_lat, drivingtable$o_lon, sep = &quot;+&quot;),
  destination = paste(drivingtable$d_lat, drivingtable$d_lon, sep = &quot;+&quot;),
  combinations = &quot;pairwise&quot;,
  mode = &quot;driving&quot;,
  arr_date = as.character(funct_calldate),
  arr_time = as.character(funct_calltime),
  key = get.api.key()
)</code></pre>
<p>The function gives distances in meters and duration in seconds. As such, we will convert them to miles and minutes respectively.</p>
<pre class="r"><code>tr_tbl &lt;- data.frame(tr_matrix)
tr_tbl &lt;- data.frame(&quot;minutes&quot; = tr_tbl$Time.Time/60, # converting time to minutes from seconds
                     &quot;miles&quot; = tr_tbl$Distance.Distance*0.000621371, # converting distance to miles from meters
                     &quot;uqlatlongid&quot; = paste(tr_tbl$Time.or, tr_tbl$Time.de, sep = &quot;+&quot;)) # we create a unique identifier tag of the o_latlong and d_latlong, on which we can merge later.

write.csv(tr_tbl, &quot;tr_tbl.csv&quot;) # we save the output files to a system location.

dr_tbl &lt;- data.frame(dr_matrix)
dr_tbl &lt;- data.frame(&quot;minutes&quot; = dr_tbl$Time.Time/60, # converting time to minutes from seconds
                     &quot;miles&quot; = dr_tbl$Distance.Distance*0.000621371, # converting distance to miles from meters
                     &quot;uqlatlongid&quot; = paste(dr_tbl$Time.or, dr_tbl$Time.de, sep = &quot;+&quot;)) # we create a unique identifier tag of the o_latlong and d_latlong, on which we can merge later.

write.csv(dr_tbl, &quot;dr_tbl.csv&quot;) # we save the output files to a system location.</code></pre>
<p>The following tables are run using a sample of 2000 randomly picked OD pairs. As such, they will not reflect the true count, and should be treated as such.</p>
<p><strong>Transit Table</strong></p>
<pre><code>##       X   minutes      miles                                  uqlatlongid
## 1     1 13.766667  7.7832931     42.106726+-71.022045+42.207743+-71.00107
## 2     2  5.316667  2.5619126    42.172757+-71.010776+42.207009+-71.004163
## 3     3  6.350000  2.8545784     42.172757+-71.010776+42.207743+-71.00107
## 4     4 21.016667  7.1184262    42.172757+-71.010776+42.251847+-71.005168
## 5     5 20.483333  6.8630427    42.175883+-71.013386+42.251847+-71.005168
## 6     6 20.200000  6.6927870    42.178209+-71.014478+42.251847+-71.005168
## 7     7  5.083333  2.1946824     42.181375+-71.013639+42.207743+-71.00107
## 8     8 25.250000  7.7404185    42.184948+-71.054721+42.284195+-71.063879
## 9     9 20.783333  6.4125487    42.187006+-70.955457+42.251696+-71.004973
## 10   10 20.966667  7.5223173    42.187707+-71.056582+42.284195+-71.063879
## 11   11 20.966667  7.3893439    42.189438+-71.057732+42.284195+-71.063879
## 12   12 20.033333  6.1093197    42.189722+-70.952463+42.251696+-71.004973
## 13   13 19.966667  7.3141580    42.190404+-71.058382+42.284195+-71.063879
## 14   14 20.850000  7.2346226    42.191457+-71.059112+42.284195+-71.063879
## 15   15 18.966667  7.1383100    42.192747+-71.059709+42.284195+-71.063879
## 16   16 13.483333  1.3483751     42.195516+-71.005134+42.207743+-71.00107
## 17   17  6.400000  0.9929509     42.200666+-71.005039+42.207743+-71.00107
## 18   18  7.400000  0.3429968    42.203362+-70.998511+42.202279+-71.004953
## 19   19 20.833333  3.7785571    42.207009+-71.004163+42.251847+-71.005168
## 20   20  5.933333  1.9579400     42.207481+-71.00164+42.233391+-71.007153
## 21   21  9.566667  3.2553627     42.207481+-71.00164+42.251809+-71.005409
## 22   22 22.783333  8.9148097     42.207481+-71.00164+42.320563+-71.052251
## 23   23 26.200000  9.7107860     42.207481+-71.00164+42.330154+-71.057655
## 24   24 30.950000 11.3766816     42.207481+-71.00164+42.352271+-71.055242
## 25   25 32.850000 11.7053869     42.207481+-71.00164+42.355518+-71.060225
## 26   26 34.566667 11.8203405  42.207481+-71.00164+42.35639457+-71.0624242
## 27   27 41.233333 12.4448184     42.207481+-71.00164+42.361269+-71.071678
## 28   28 39.583333 13.1277051     42.207481+-71.00164+42.362434+-71.085591
## 29   29 41.400000 14.0995294     42.207481+-71.00164+42.365379+-71.103554
## 30   30 45.066667 15.0732177     42.207481+-71.00164+42.373362+-71.118956
## 31   31 49.950000 16.7739101      42.207481+-71.00164+42.39674+-71.121815
## 32   32 22.716667  8.1492807     42.207743+-71.00107+42.106726+-71.022045
## 33   33 11.866667  3.4778135     42.207743+-71.00107+42.168243+-71.006992
## 34   34 10.316667  3.3174998     42.207743+-71.00107+42.170188+-71.008608
## 35   35  9.966667  3.1261175     42.207743+-71.00107+42.172496+-71.010689
## 36   36  8.566667  2.5706118     42.207743+-71.00107+42.179804+-71.014772
## 37   37 12.833333  1.1998674     42.207743+-71.00107+42.195716+-71.005277
## 38   38  6.233333  0.8512783     42.207743+-71.00107+42.203754+-71.005144
## 39   39 13.016667  0.6250992     42.207743+-71.00107+42.206072+-71.004532
## 40   40  4.000000  0.8320158     42.207743+-71.00107+42.212779+-71.004498
## 41   41 19.916667  3.4293465     42.207743+-71.00107+42.214859+-71.004456
## 42   42  4.683333  1.6640315    42.208469+-70.957953+42.190805+-70.951359
## 43   43 12.783333  0.6418762     42.209933+-71.003667+42.207743+-71.00107
## 44   44  4.116667  0.6250992     42.212953+-71.004648+42.207743+-71.00107
## 45   45  4.466667  0.7705000     42.215052+-71.004547+42.207743+-71.00107
## 46   46 16.200000  5.1965257      42.217651+-70.936794+42.251908+-71.0052
## 47   47 25.283333  3.0745437     42.217701+-71.00306+42.251847+-71.005168
## 48   48  6.833333  0.3398899    42.219946+-71.027761+42.220488+-71.023648
## 49   49  2.966667  0.8015686    42.220488+-71.023648+42.225927+-71.031761
## 50   50  7.400000  1.4975041    42.226141+-71.032004+42.220488+-71.023648
## 51   51  9.666667  2.0902920     42.22958+-71.030926+42.233238+-71.007244
## 52   52  9.300000  1.9243860     42.23187+-71.029931+42.233238+-71.007244
## 53   53  4.000000  1.6795658     42.23187+-71.029931+42.233844+-71.010995
## 54   54 12.333333  2.0797287    42.231897+-71.005637+42.251847+-71.005168
## 55   55  9.866667  2.0349900     42.232065+-71.005795+42.207743+-71.00107
## 56   56 26.000000  6.5424153    42.233122+-71.183972+42.291606+-71.122523
## 57   57 31.600000  7.3253427    42.233122+-71.183972+42.300749+-71.114314
## 58   58 16.533333  2.0791074    42.233238+-71.007244+42.229778+-71.030998
## 59   59  6.516667  0.3088214    42.233238+-71.007244+42.234648+-71.011635
## 60   60 12.266667  1.3893856    42.233238+-71.007244+42.238421+-71.025546
## 61   61  2.733333  1.3334622    42.233391+-71.007153+42.251809+-71.005409
## 62   62 15.950000  6.9929092    42.233391+-71.007153+42.320563+-71.052251
## 63   63 19.333333  7.7888855    42.233391+-71.007153+42.330154+-71.057655
## 64   64 21.583333  8.6171730    42.233391+-71.007153+42.342622+-71.056967
## 65   65 24.200000  9.4547811    42.233391+-71.007153+42.352271+-71.055242
## 66   66 26.100000  9.7834864    42.233391+-71.007153+42.355518+-71.060225
## 67   67 27.733333  9.8984400 42.233391+-71.007153+42.35639457+-71.0624242
## 68   68 34.316667 10.5229179    42.233391+-71.007153+42.361269+-71.071678
## 69   69 32.666667 11.2058046    42.233391+-71.007153+42.362434+-71.085591
## 70   70 34.566667 12.1776289    42.233391+-71.007153+42.365379+-71.103554
## 71   71 38.233333 13.1513172    42.233391+-71.007153+42.373362+-71.118956
## 72   72 41.400000 14.2188326      42.233391+-71.007153+42.3884+-71.119149
## 73   73 42.983333 14.8520096     42.233391+-71.007153+42.39674+-71.121815
## 74   74  5.300000  0.2448202    42.233844+-71.010995+42.233238+-71.007244
## 75   75 17.583333  1.9051235    42.234422+-70.999344+42.251696+-71.004973
## 76   76 13.250000  1.6000303     42.234422+-70.999344+42.252035+-71.00588
## 77   77  6.866667  0.3212488    42.234737+-71.011882+42.233238+-71.007244
## 78   78 17.500000  4.8603640    42.235738+-71.028307+42.251847+-71.005168
## 79   79 10.550000  2.2996941     42.236417+-71.004919+42.207743+-71.00107
## 80   80  9.766667  0.4685137     42.23644+-71.013608+42.233238+-71.007244
## 81   81 10.850000  3.5331155        42.2366+-70.944211+42.2516+-71.003123
## 82   82 12.083333  3.7661296        42.2366+-70.944211+42.251908+-71.0052
## 83   83  3.216667  1.1613424    42.237363+-71.132128+42.252026+-71.125219
## 84   84  8.600000  2.4680856    42.237363+-71.132128+42.270456+-71.120425
## 85   85 10.300000  3.1292244    42.237363+-71.132128+42.279969+-71.118822
## 86   86 19.800000  4.6901083    42.237363+-71.132128+42.300479+-71.113634
## 87   87  5.933333  0.6045940     42.23795+-71.015132+42.233238+-71.007244
## 88   88  8.633333  1.7920340    42.238599+-70.983246+42.251696+-71.004973
## 89   89 27.783333  6.3976358    42.238726+-71.180957+42.294688+-71.119267
## 90   90 30.600000  6.9102669    42.238726+-71.180957+42.300749+-71.114314
## 91   91  1.166667  0.4063766    42.239085+-71.132172+42.244466+-71.129544
## 92   92 19.333333  4.5055611    42.239085+-71.132172+42.300479+-71.113634
## 93   93  6.166667  0.7313537     42.23944+-71.016616+42.233238+-71.007244
## 94   94 11.600000  1.9293570    42.240337+-70.983788+42.251696+-71.004973
## 95   95  9.600000  1.8268307     42.240337+-70.983788+42.252035+-71.00588
## 96   96  8.066667  1.5347864    42.240464+-70.987378+42.251696+-71.004973
## 97   97  6.066667  1.4322602     42.240464+-70.987378+42.252035+-71.00588
## 98   98 11.283333  3.4877554      42.240551+-70.944069+42.251908+-71.0052
## 99   99 10.733333  1.4148618    42.241031+-71.003354+42.251847+-71.005168
## 100 100 11.100000  3.3933070      42.241764+-70.944077+42.251908+-71.0052</code></pre>
<p>We now merge the distances table with the legs table based on the <code>uqlatlongid</code>. This way, based on the corresponding mode of the OD pair, we get the leg’s distance, and time.</p>
<pre class="r"><code>bus_subway &lt;- merge(legs, tr_tbl[,2:4], by = &quot;uqlatlongid&quot;)</code></pre>
<p>We now add the emissions column to the bus_subway table. The emissions table will merge based on the mode, and multiply the distance with the emissions factor.</p>
<pre class="r"><code>bus_subway$trip_emissions &lt;- ifelse(str_detect(bus_subway$mode, pattern = &quot;subway&quot;),
                                    bus_subway$miles*emissions_bymode$co2_subway, # if the trip is made by rapid transit
                                    bus_subway$miles*emissions_bymode$co2_bus) # if the trip is made by bus
bus_subway &lt;- distinct(bus_subway)</code></pre>
<p>We also write this bus_subway table to use for other analysis, for example in Tableau:</p>
<p>And finally the output table for the number of trips by mode for every company along with the total minutes, miles, and emissions in pounds of <span class="math inline">\(CO2\)</span> totaled by month:</p>
<pre class="r"><code>bus_subway &lt;- bus_subway %&gt;% distinct() %&gt;% drop_na() %&gt;% 
  select(idcompany, companyname, mode, count, minutes, miles, trip_emissions) %&gt;% 
  group_by(idcompany, companyname, mode) %&gt;% 
  summarise(trip_count = sum(count), 
            minutes = sum(minutes),
            miles = sum(miles),
            trip_emissions = sum(trip_emissions))

bus_subway &lt;- data.frame(&quot;idcompany&quot; = bus_subway$idcompany,
                         &quot;companyname&quot; = bus_subway$companyname,
                         &quot;mode&quot; = bus_subway$mode,
                         &quot;trip_count&quot; = floor(bus_subway$trip_count*scalefactor_tbl$scalefactor),
                         &quot;minutes&quot; = bus_subway$minutes*scalefactor_tbl$scalefactor,
                         &quot;miles&quot; = bus_subway$miles*scalefactor_tbl$scalefactor,
                         &quot;trip_emissions&quot; = bus_subway$trip_emissions*scalefactor_tbl$scalefactor)</code></pre>
<pre><code>##    idcompany companyname   mode trip_count      minutes      miles
## 1       1025   Company E    bus       4374    55159.692  8576.4269
## 2       1025   Company E subway       7698    97693.768 27022.0381
## 3       1110   Company F    bus       2347    36773.933  4943.2892
## 4       1110   Company F subway       6900    86689.871 19803.8576
## 5       1136   Company N    bus       1367    22813.685  4878.3914
## 6       1136   Company N subway       4033    62383.874 15911.5758
## 7       1709   Company B    bus       1025    13637.030  2031.6702
## 8       1709   Company B subway       3284    41369.609 12630.7191
## 9       1762   Company L    bus       1434    19939.785  3997.9033
## 10      1762   Company L subway       5503    77078.501 21863.5002
## 11      1783   Company M    bus       1091 93493139.853  2067.6700
## 12      1783   Company M subway       3910    44091.897 11592.7395
## 13      1801   Company K    bus       1667    23497.739  3386.6113
## 14      1801   Company K subway       3147    50634.975 11303.6910
## 15      1840   Company I    bus        369     4037.403   570.2343
## 16      1840   Company I subway       2115    23994.209  6854.9027
## 17      1858   Company J    bus        791    13491.605  2474.4607
## 18      1858   Company J subway       4207    55810.013 13265.0555
## 19      1904   Company A    bus        707    12219.993  2499.5045
## 20      1904   Company A subway       2650    42244.506 11939.8802
## 21      1968   Company H    bus       2807    38509.938  6448.4615
## 22      1968   Company H subway       2497    39245.631  9793.5928
## 23      2456   Company O    bus       2475    35119.878  4755.0367
## 24      2456   Company O subway       3783    54787.402 12699.3989
## 25      3171   Company D    bus       1255    17738.632  2621.4832
## 26      3171   Company D subway       4790    53107.516 13461.3594
## 27      3199   Company C    bus        968    15359.044  2256.6275
## 28      3199   Company C subway       5236    64578.953 16557.9799
## 29      3480   Company G    bus       1254    16450.415  2937.0559
## 30      3480   Company G subway       6058    82206.250 22129.4508
## 31      3574   Company Q    bus       1726    27073.528  3604.0335
## 32      3574   Company Q subway       6628    83060.512 15786.5028
## 33     11078   Company P    bus        850    10643.801  1550.2784
## 34     11078   Company P subway       4858    69125.955 18076.3442
##    trip_emissions
## 1       2023.1791
## 2       6315.0503
## 3       1166.1219
## 4       4628.1615
## 5       1150.8125
## 6       3718.5353
## 7        479.2710
## 8       2951.7990
## 9        943.1054
## 10      5109.5000
## 11       487.7633
## 12      2709.2232
## 13       798.9016
## 14      2641.6726
## 15       134.5183
## 16      1601.9907
## 17       583.7253
## 18      3100.0435
## 19       589.6331
## 20      2790.3500
## 21      1521.1921
## 22      2288.7626
## 23      1121.7131
## 24      2967.8495
## 25       618.4079
## 26      3145.9197
## 27       532.3384
## 28      3869.5999
## 29       692.8515
## 30      5171.6527
## 31       850.1915
## 32      3689.3057
## 33       365.7107
## 34      4224.4416</code></pre>
<p><strong>Driving Table</strong></p>
<pre><code>##       X   minutes      miles                                 uqlatlongid
## 1     1 19.950000  8.1902912    42.106726+-71.022045+42.207743+-71.00107
## 2     2 39.083333 24.9840852   42.106726+-71.022045+42.362434+-71.085591
## 3     3  7.233333  2.6638175   42.172757+-71.010776+42.207009+-71.004163
## 4     4  8.366667  3.1049909    42.172757+-71.010776+42.207743+-71.00107
## 5     5 17.300000  6.9705399   42.172757+-71.010776+42.251809+-71.005409
## 6     6 17.200000  6.9599766   42.172757+-71.010776+42.251847+-71.005168
## 7     7 16.750000  6.7052145   42.175883+-71.013386+42.251847+-71.005168
## 8     8 23.700000  8.7544960   42.175883+-71.013386+42.275783+-71.030184
## 9     9 22.400000 10.1233763   42.178209+-71.014478+42.294907+-71.056242
## 10   10 34.983333 13.3706612   42.181375+-71.013639+42.300523+-71.113686
## 11   11 19.650000  7.1115911   42.184948+-71.054721+42.284195+-71.063879
## 12   12 37.466667 17.8898925   42.184948+-71.054721+42.373362+-71.118956
## 13   13 10.933333  4.0513389   42.187006+-70.955457+42.237963+-70.944602
## 14   14 19.033333  6.8972181   42.187707+-71.056582+42.284195+-71.063879
## 15   15 18.783333  6.7642447   42.189438+-71.057732+42.284195+-71.063879
## 16   16 12.050000  4.5310373   42.189722+-70.952463+42.242902+-70.950907
## 17   17 11.483333  4.2961591   42.189722+-70.952463+42.243572+-70.946418
## 18   18 33.050000 15.9909827   42.190404+-71.058382+42.374262+-71.030395
## 19   19 30.033333 15.7710174   42.190404+-71.058382+42.374693+-71.029333
## 20   20 18.183333  6.6076592   42.191457+-71.059112+42.284195+-71.063879
## 21   21 32.800000 15.9872545   42.191457+-71.059112+42.362434+-71.085591
## 22   22 36.000000 17.3865820   42.191457+-71.059112+42.373362+-71.118956
## 23   23 23.316667 11.1995909   42.192747+-71.059709+42.330154+-71.057655
## 24   24 32.283333 15.8921847   42.192747+-71.059709+42.362434+-71.085591
## 25   25 35.483333 17.2915122   42.192747+-71.059709+42.373362+-71.118956
## 26   26 20.533333 12.6231519   42.195516+-71.005134+42.352271+-71.055242
## 27   27 24.950000 14.7799306   42.195516+-71.005134+42.361269+-71.071678
## 28   28 19.066667 12.6604341   42.200666+-71.005039+42.352271+-71.055242
## 29   29 11.300000  4.2377502   42.207009+-71.004163+42.251847+-71.005168
## 30   30 25.166667 10.3961582   42.207009+-71.004163+42.300523+-71.113686
## 31   31 12.033333  4.2539059    42.207481+-71.00164+42.251809+-71.005409
## 32   32 25.816667 10.4011292    42.207481+-71.00164+42.300523+-71.113686
## 33   33 14.583333  9.7306699    42.207481+-71.00164+42.320563+-71.052251
## 34   34 18.066667 10.7689808    42.207481+-71.00164+42.330154+-71.057655
## 35   35 26.383333 12.8915841    42.207481+-71.00164+42.330714+-71.096023
## 36   36 28.383333 13.3228156    42.207481+-71.00164+42.334331+-71.104487
## 37   37 27.133333 13.0593543     42.207481+-71.00164+42.33608+-71.099883
## 38   38 26.800000 12.8070777    42.207481+-71.00164+42.336377+-71.088961
## 39   39 29.466667 12.9617991     42.207481+-71.00164+42.337875+-71.09524
## 40   40 27.833333 12.6691333     42.207481+-71.00164+42.339897+-71.09021
## 41   41 33.533333 13.6297729    42.207481+-71.00164+42.345088+-71.104843
## 42   42 26.700000 18.3391437     42.207481+-71.00164+42.34557+-71.081696
## 43   43 28.516667 16.7186081    42.207481+-71.00164+42.345884+-71.107697
## 44   44 25.600000 12.6181809     42.207481+-71.00164+42.34735+-71.075727
## 45   45 28.216667 12.7082797    42.207481+-71.00164+42.347888+-71.087903
## 46   46 22.416667 12.6865317      42.207481+-71.00164+42.34863+-71.04246
## 47   47 27.500000 16.2569295    42.207481+-71.00164+42.348949+-71.095169
## 48   48 27.283333 12.6138313    42.207481+-71.00164+42.350126+-71.077376
## 49   49 17.716667 12.2223676    42.207481+-71.00164+42.352271+-71.055242
## 50   50 24.516667 12.6374434    42.207481+-71.00164+42.355518+-71.060225
## 51   51 25.083333 13.7366487 42.207481+-71.00164+42.35639457+-71.0624242
## 52   52 23.266667 13.5117124    42.207481+-71.00164+42.359705+-71.059215
## 53   53 22.133333 14.3785249    42.207481+-71.00164+42.361269+-71.071678
## 54   54 27.033333 15.4615746    42.207481+-71.00164+42.362434+-71.085591
## 55   55 28.950000 16.5993049    42.207481+-71.00164+42.365379+-71.103554
## 56   56 27.216667 15.4472831     42.207481+-71.00164+42.365535+-71.09133
## 57   57 24.883333 14.5015564    42.207481+-71.00164+42.370958+-71.077416
## 58   58 30.233333 16.8609021    42.207481+-71.00164+42.373362+-71.118956
## 59   59 20.583333 14.2641927    42.207481+-71.00164+42.374067+-71.070929
## 60   60 41.383333 18.7324715     42.207481+-71.00164+42.39674+-71.121815
## 61   61  8.000000  3.1671280    42.207743+-71.00107+42.170188+-71.008608
## 62   62  7.683333  2.9757457    42.207743+-71.00107+42.172496+-71.010689
## 63   63  6.700000  2.4196187    42.207743+-71.00107+42.179804+-71.014772
## 64   64  3.966667  0.8220738    42.207743+-71.00107+42.203754+-71.005144
## 65   65  3.433333  0.6592746    42.207743+-71.00107+42.206072+-71.004532
## 66   66  4.516667  1.6559537   42.208469+-70.957953+42.190805+-70.951359
## 67   67 26.916667 12.7138720   42.209933+-71.003667+42.350126+-71.077376
## 68   68  4.100000  0.9966791    42.212953+-71.004648+42.207743+-71.00107
## 69   69 26.816667 17.5040211    42.212953+-71.004648+42.34557+-71.081696
## 70   70 27.416667 11.7780873   42.212953+-71.004648+42.350126+-71.077376
## 71   71  4.500000  1.1420799    42.215052+-71.004547+42.207743+-71.00107
## 72   72 27.016667 11.6326865   42.215052+-71.004547+42.350126+-71.077376
## 73   73 30.000000 14.2331241   42.217651+-70.936794+42.352271+-71.055242
## 74   74 26.500000 11.4294982    42.217701+-71.00306+42.350126+-71.077376
## 75   75  3.350000  0.9618823   42.219946+-71.027761+42.220488+-71.023648
## 76   76  3.500000  0.7941121   42.220488+-71.023648+42.225927+-71.031761
## 77   77  5.150000  1.4596005   42.226141+-71.032004+42.220488+-71.023648
## 78   78 14.350000  9.6511344    42.22958+-71.030926+42.352271+-71.055242
## 79   79 21.166667 10.0655888    42.22958+-71.030926+42.355518+-71.060225
## 80   80 14.050000  9.4833642    42.23187+-71.029931+42.352271+-71.055242
## 81   81 21.433333 10.9976453 42.23187+-71.029931+42.35639457+-71.0624242
## 82   82  8.933333  1.8523070   42.231897+-71.005637+42.251847+-71.005168
## 83   83 21.816667 11.1498812   42.232065+-71.005795+42.355518+-71.060225
## 84   84 14.866667  5.0418043   42.233122+-71.183972+42.265986+-71.121172
## 85   85 17.566667  5.6669035   42.233122+-71.183972+42.270468+-71.120666
## 86   86 18.733333  5.6022809     42.233122+-71.183972+42.272702+-71.1203
## 87   87 18.350000  5.3475188   42.233122+-71.183972+42.279888+-71.119028
## 88   88 21.116667  7.4819282   42.233122+-71.183972+42.300749+-71.114314
## 89   89  6.816667  1.8516856   42.233238+-71.007244+42.238421+-71.025546
## 90   90  6.933333  1.6882650   42.233391+-71.007153+42.251809+-71.005409
## 91   91 17.583333  6.9469278   42.233391+-71.007153+42.320563+-71.052251
## 92   92 21.066667  7.9858601   42.233391+-71.007153+42.330154+-71.057655
## 93   93 29.383333 10.1084634   42.233391+-71.007153+42.330714+-71.096023
## 94   94 31.400000 10.5390735   42.233391+-71.007153+42.334331+-71.104487
## 95   95 30.850000 10.0370058    42.233391+-71.007153+42.33608+-71.099883
## 96   96 29.800000 10.0233356   42.233391+-71.007153+42.336377+-71.088961
## 97   97 31.500000 10.3309142    42.233391+-71.007153+42.337875+-71.09524
## 98   98 30.833333  9.8853912    42.233391+-71.007153+42.339897+-71.09021
## 99   99 25.500000  8.6258722   42.233391+-71.007153+42.342622+-71.056967
## 100 100 31.133333 10.2277667   42.233391+-71.007153+42.342687+-71.085056</code></pre>
<p>We now merge the distances table with the distinctjourneys table based on the <code>uqlatlongid</code>. This way, based on the corresponding mode of the OD pair, we get the journey’s distance, and time.</p>
<pre class="r"><code>car &lt;- merge(distinctjourneys, dr_tbl[,2:4], by = &quot;uqlatlongid&quot;)
car$count &lt;- rep(1,nrow(car))</code></pre>
<p>We now add the emissions column to the car table. The emissions table will merge based on the mode, and multiply the distance with the emissions factor.</p>
<pre class="r"><code>car$mode &lt;- rep(&quot;car&quot;, nrow(car))
car$trip_emissions &lt;- car$miles*emissions_bymode$co2_car
car &lt;- distinct(car)</code></pre>
<p>We also write this car table to use for other analysis, for example in Tableau:</p>
<p>And finally the output table for equivalent car trips for subway and bus trips:</p>
<pre class="r"><code>car &lt;- car %&gt;% distinct() %&gt;% drop_na() %&gt;% 
  select(idcompany, companyname, mode, count, minutes, miles, trip_emissions) %&gt;%
  group_by(idcompany, companyname, mode) %&gt;% 
  summarise(trip_count = sum(count), 
            minutes = sum(minutes),
            miles = sum(miles),
            trip_emissions = sum(trip_emissions))

car &lt;- data.frame(&quot;idcompany&quot; = car$idcompany,
                  &quot;companyname&quot; = car$companyname,
                  &quot;mode&quot; = car$mode,
                  &quot;trip_count&quot; = floor(car$trip_count*scalefactor_cars$scalefactor),
                  &quot;minutes&quot; = car$minutes*scalefactor_cars$scalefactor,
                  &quot;miles&quot; = car$miles*scalefactor_cars$scalefactor,
                  &quot;trip_emissions&quot; = car$trip_emissions*scalefactor_cars$scalefactor)</code></pre>
<pre><code>##    idcompany companyname mode trip_count   minutes     miles
## 1       1025   Company E  car       8745 144703.66 41379.410
## 2       1110   Company F  car       8124 119522.33 34990.335
## 3       1136   Company N  car       4219  73734.37 23342.557
## 4       1709   Company B  car       3611  64761.61 17276.250
## 5       1762   Company L  car       5540  91907.56 31833.846
## 6       1783   Company M  car       3928  61293.23 17018.948
## 7       1801   Company K  car       3841  60020.42 17021.310
## 8       1840   Company I  car       1801  29502.35  7721.607
## 9       1858   Company J  car       3394  57619.96 17059.841
## 10      1904   Company A  car       3148  57340.46 19090.123
## 11      1968   Company H  car       3784  62094.08 18637.527
## 12      2456   Company O  car       4644  71489.55 19068.973
## 13      3171   Company D  car       4281  65239.68 18546.992
## 14      3199   Company C  car       4499  74842.45 19987.587
## 15      3480   Company G  car       6071 108970.26 30314.868
## 16      3574   Company Q  car       6663  92532.31 23401.193
## 17     11078   Company P  car       4064  74964.26 20695.427
##    trip_emissions
## 1       36033.191
## 2       30469.584
## 3       20326.699
## 4       15044.159
## 5       27720.913
## 6       14820.100
## 7       14822.156
## 8        6723.976
## 9       14855.710
## 10      16623.679
## 11      16229.559
## 12      16605.261
## 13      16150.721
## 14      17405.191
## 15      26398.187
## 16      20377.758
## 17      18021.578</code></pre>
</div>
<div id="journey-emissions-data-for-commuter-rail" class="section level3">
<h3>Journey Emissions data for Commuter Rail</h3>
<p>As the commuter rail data is stored separately, and is not calculated through ODX (As we do not currently employ AFC for commuter rail), we have to make assumptions based on pass counts and working days.</p>
<p>Therefore, we multiply all fields which will be enumerated by the number of working days in the given month and 2 (to account for to/fro trips)</p>
<pre class="r"><code>commrail &lt;- cr_bycompany %&gt;% merge(cr_reference, by = &quot;zone&quot;)</code></pre>
<p>We separate the commuter rail table by numbers for commuter rail and numbers for driving. This is so, we can later merge the driving tables for both commuter rail with that of the corresponding driving table for bus and subway.</p>
<pre class="r"><code>cr_tr &lt;- data.frame(&quot;idcompany&quot; = commrail$idcompany,
                    &quot;companyname&quot; = commrail$companyname,
                    &quot;mode&quot; = &quot;commrail&quot;,
                    &quot;trip_count&quot; = commrail$count*w_days*2,
                    &quot;minutes&quot; = commrail$cr_min_tr*commrail$count*w_days*2,
                    &quot;miles&quot; = commrail$cr_miles_tr*commrail$count*w_days*2,
                    &quot;trip_emissions&quot; = commrail$cr_miles_tr*commrail$count*w_days*2*emissions_bymode$co2_commrail)

cr_tr &lt;- cr_tr %&gt;% distinct() %&gt;% drop_na() %&gt;% 
                    select(idcompany, companyname, mode, trip_count, minutes, miles, trip_emissions) %&gt;%
                    group_by(idcompany, companyname, mode) %&gt;% 
                    summarise(trip_count = sum(trip_count), 
                              minutes = sum(minutes),
                              miles = sum(miles),
                              trip_emissions = sum(trip_emissions))</code></pre>
<pre><code>## # A tibble: 17 x 7
## # Groups:   idcompany, companyname [17]
##    idcompany companyname mode     trip_count minutes   miles trip_emissions
##        &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;
##  1      1025 Company E   commrail       1596  67169.  25492.          9779.
##  2      1110 Company F   commrail       2660 103593.  34987.         13421.
##  3      1136 Company N   commrail       4256 180832.  70804.         27161.
##  4      1709 Company B   commrail       4370 223117.  97524.         37410.
##  5      1762 Company L   commrail       4142 173144.  65293.         25046.
##  6      1783 Company M   commrail       5244 262269. 114745.         44016.
##  7      1801 Company K   commrail       3838 193282.  83589.         32065.
##  8      1840 Company I   commrail       1672  74519.  30115.         11552.
##  9      1858 Company J   commrail       5054 230076.  95634.         36685.
## 10      1904 Company A   commrail       2584 114503.  46311.         17765.
## 11      1968 Company H   commrail        228   9544.   3403.          1305.
## 12      2456 Company O   commrail       3192 139696.  55301.         21213.
## 13      3171 Company D   commrail       3192 144751.  60079.         23046.
## 14      3199 Company C   commrail       3154 170791.  76824.         29470.
## 15      3480 Company G   commrail       2318  98214.  37912.         14543.
## 16      3574 Company Q   commrail        114   3313.    472.           181.
## 17     11078 Company P   commrail       3458 185079.  83268.         31942.</code></pre>
<pre class="r"><code>cr_dr &lt;- data.frame(&quot;idcompany&quot; = commrail$idcompany,
                    &quot;companyname&quot; = commrail$companyname,
                    &quot;mode&quot; = &quot;car&quot;,
                    &quot;trip_count&quot; = commrail$count*w_days*2,
                    &quot;minutes&quot; = commrail$cr_min_dr*commrail$count*w_days*2,
                    &quot;miles&quot; = commrail$cr_miles_dr*commrail$count*w_days*2,
                    &quot;trip_emissions&quot; = commrail$cr_miles_dr*commrail$count*w_days*2*emissions_bymode$co2_car)

cr_dr &lt;- cr_dr %&gt;% distinct() %&gt;% drop_na() %&gt;% 
                    select(idcompany, companyname, mode, trip_count, minutes, miles, trip_emissions) %&gt;%
                    group_by(idcompany, companyname, mode) %&gt;% 
                    summarise(trip_count = sum(trip_count), 
                              minutes = sum(minutes),
                              miles = sum(miles),
                              trip_emissions = sum(trip_emissions))</code></pre>
<pre><code>## # A tibble: 17 x 7
## # Groups:   idcompany, companyname [17]
##    idcompany companyname mode  trip_count minutes   miles trip_emissions
##        &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;
##  1      1025 Company E   car         1596  47339.  32179.         28022.
##  2      1110 Company F   car         2660  69883.  44887.         39088.
##  3      1136 Company N   car         4256 128328.  90237.         78579.
##  4      1709 Company B   car         4370 159287. 119341.        103922.
##  5      1762 Company L   car         4142 121244.  83511.         72721.
##  6      1783 Company M   car         5244 187892. 140237.        122118.
##  7      1801 Company K   car         3838 135168. 101362.         88266.
##  8      1840 Company I   car         1672  52956.  37731.         32856.
##  9      1858 Company J   car         5054 164160. 119953.        104455.
## 10      1904 Company A   car         2584  82082.  58509.         50950.
## 11      1968 Company H   car          228   6301.   4173.          3634.
## 12      2456 Company O   car         3192  99040.  69653.         60653.
## 13      3171 Company D   car         3192 103489.  74877.         65203.
## 14      3199 Company C   car         3154 120669.  92110.         80209.
## 15      3480 Company G   car         2318  68890.  48013.         41809.
## 16      3574 Company Q   car          114   1832.    765.           666.
## 17     11078 Company P   car         3458 130363. 100123.         87187.</code></pre>
<p>Now that we have calculations for all four modes of transport ready, we merge the tables to get the final output:</p>
<pre class="r"><code>transit_tbl &lt;- bind_rows(bus_subway, cr_tr)</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): Unequal factor levels: coercing to character</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector</code></pre>
<pre class="r"><code>cars_tbl &lt;- data.frame(&quot;idcompany&quot; = car$idcompany,
                       &quot;companyname&quot; = car$companyname,
                       &quot;mode&quot; = car$mode,
                       &quot;trip_count&quot; = car$trip_count+cr_dr$trip_count,
                       &quot;minutes&quot; = car$minutes+cr_dr$minutes,
                       &quot;miles&quot; = car$miles+cr_dr$miles,
                       &quot;trip_emissions&quot; = car$trip_emissions+cr_dr$trip_emissions)

company_emissions_tbl &lt;- bind_rows(transit_tbl, cars_tbl)</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector</code></pre>
</div>
</div>
</div>
<div id="final-output-table" class="section level1">
<h1>Final Output Table</h1>
<p>The final output table contains information on the number of trips done by employees of a given company by mode type, and the time it took (in minutes), distance travelled (in miles) and pounds of <span class="math inline">\(CO_2\)</span> emitted. All figures are for a monthly basis, with this example for the month of September 2018.</p>
<div id="htmlwidget-de04bdb2390455697312" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-de04bdb2390455697312">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68"],[1025,1025,1110,1110,1136,1136,1709,1709,1762,1762,1783,1783,1801,1801,1840,1840,1858,1858,1904,1904,1968,1968,2456,2456,3171,3171,3199,3199,3480,3480,3574,3574,11078,11078,1025,1110,1136,1709,1762,1783,1801,1840,1858,1904,1968,2456,3171,3199,3480,3574,11078,1025,1110,1136,1709,1762,1783,1801,1840,1858,1904,1968,2456,3171,3199,3480,3574,11078],["Company E","Company E","Company F","Company F","Company N","Company N","Company B","Company B","Company L","Company L","Company M","Company M","Company K","Company K","Company I","Company I","Company J","Company J","Company A","Company A","Company H","Company H","Company O","Company O","Company D","Company D","Company C","Company C","Company G","Company G","Company Q","Company Q","Company P","Company P","Company E","Company F","Company N","Company B","Company L","Company M","Company K","Company I","Company J","Company A","Company H","Company O","Company D","Company C","Company G","Company Q","Company P","Company E","Company F","Company N","Company B","Company L","Company M","Company K","Company I","Company J","Company A","Company H","Company O","Company D","Company C","Company G","Company Q","Company P"],["bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","bus","subway","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","commrail","car","car","car","car","car","car","car","car","car","car","car","car","car","car","car","car","car"],[4374,7698,2347,6900,1367,4033,1025,3284,1434,5503,1091,3910,1667,3147,369,2115,791,4207,707,2650,2807,2497,2475,3783,1255,4790,968,5236,1254,6058,1726,6628,850,4858,1596,2660,4256,4370,4142,5244,3838,1672,5054,2584,228,3192,3192,3154,2318,114,3458,10341,10784,8475,7981,9682,9172,7679,3473,8448,5732,4012,7836,7473,7653,8389,6777,7522],[55159.6924536727,97693.7682981316,36773.9328711727,86689.8710718569,22813.6849188373,62383.8739330269,13637.0301569916,41369.6094393267,19939.7854477612,77078.5009568032,93493139.8529411,44091.896875,23497.738814994,50634.9753182645,4037.40310077519,23994.2088819769,13491.6046448087,55810.0133542812,12219.992541595,42244.5063200359,38509.9380128205,39245.6308395677,35119.8780844725,54787.4021113244,17738.6315309842,53107.5161162856,15359.0438799076,64578.9531642225,16450.4148606811,82206.2499095071,27073.5281767956,83060.5115870154,10643.8006840796,69125.9545755187,67169.10100902,103593.23142352,180832.1245258,223117.01896276,173143.71912028,262268.58650552,193281.71940486,74519.0613172,230076.06489118,114502.5552782,9544.47136808,139695.61210376,144750.79102184,170790.54978322,98213.85234194,3312.86111166,185079.30864588,192042.477419531,189405.761166138,202062.645755921,224048.290306102,213151.664688028,249185.713379535,195188.191935248,82458.194667607,221779.623095435,139421.993799404,68395.4152947069,170529.87504354,168728.251450725,195511.78962811,177860.000172774,94364.2300782971,205327.230771412],[8576.42688479347,27022.0381407983,4943.28915480224,19803.8575542736,4878.39137589665,15911.5757959095,2031.67022350403,12630.7190503578,3997.90333254851,21863.5001503204,2067.66995082844,11592.7395008843,3386.61126633715,11303.6909514906,570.234334273256,6854.90265243708,2474.46070529103,13265.0554619912,2499.50454893591,11939.8802124017,6448.46147114633,9793.59277272883,4755.03666272328,12699.3989431735,2621.48323634024,13461.3593724056,2256.62754298292,16557.9799174338,2937.05589016632,22129.4508144465,3604.03353534732,15786.5028450147,1550.27840104619,18076.344236759,25492.130595468,34986.767634948,70804.420405448,97524.18399632,65292.528302684,114744.552983204,83589.11501134,30114.517915508,95633.715998248,46310.511166716,3402.591452996,55300.784606416,60078.57232902,76824.094073852,37911.97925442,472.466666616,83268.360872064,73558.772754149,79877.6581305754,113579.712201333,136617.458933194,115344.975164284,157256.002005017,118383.477744137,45452.1657795464,137013.021739253,77599.2892329659,22810.7138998414,88721.5347826037,93424.1678386974,112097.256331227,78327.3736860418,24165.9099429452,120818.782204805],[2023.17910212278,6315.05031350457,1166.12191161785,4628.16151043374,1150.81252557402,3718.53526350405,479.271005724601,2951.79904206862,943.105396148193,5109.49998512988,487.763341400428,2709.22322135667,798.901597728933,2641.67257536336,134.518279455061,1601.99074987455,583.725280378155,3100.04346146735,589.633123093981,2790.35000563828,1521.19206104342,2288.76263098673,1121.71314873642,2967.84953301966,618.407895452662,3145.91968533119,532.338437389671,3869.59990670429,692.851484490234,5171.65265533614,850.191510988433,3689.30571487994,365.710674806797,4224.44164813058,9778.78129642152,13420.9240647661,27160.5756675299,37410.2769809883,25046.2138569096,44016.0105243571,32064.78451835,11551.9290723889,36685.0934569279,17764.7120835523,1305.23408136927,21213.3809750212,23046.1403454121,29469.7224867296,14543.0352419955,181.238213313898,31941.7432305237,64054.979314313,69557.4647001051,98905.2133849206,118966.483239025,100442.404373058,136938.526545969,103088.332419594,39579.745960829,119310.939330541,67573.4610640667,19863.5696639819,77258.7124886913,81353.7653539377,97614.2908132321,68207.4770058052,21043.6743783166,105208.995543944]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>idcompany<\/th>\n      <th>companyname<\/th>\n      <th>mode<\/th>\n      <th>trip_count<\/th>\n      <th>minutes<\/th>\n      <th>miles<\/th>\n      <th>trip_emissions<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"callback":"function(table) {\nreturn table;\n}"},"evals":["callback"],"jsHooks":[]}</script>
</div>
